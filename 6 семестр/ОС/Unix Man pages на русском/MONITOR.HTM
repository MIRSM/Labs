<html>
<head>
<title>MONITOR(3C)</title>
		    <style type="text/css">
TH.arial { font-family: Arial, Serif;}
P.topic { font-family: sans-serif;}
A.plain { text-decoration: none;}
A.topic01 { color: #006890;
font-family: sans-serif;
text-decoration: none;}
A.topic02 { color: #099771;
font-family: sans-serif;
text-decoration: none;}
A.topic03 { color: #719709;
font-family: sans-serif;
text-decoration: none;}
A.topic04 { color: #98650A;
font-family: sans-serif;
text-decoration: none;}
A.topic05 { color: #98340A;
font-family: sans-serif;
text-decoration: none;}
A.topic06 { color: #099607;
font-family: sans-serif;
text-decoration: none;}
A.topic07 { color: #9E1215;
font-family: sans-serif;
text-decoration: none;}
A.topic08 { color: #970941;
font-family: sans-serif;
text-decoration: none;}
A.topic09 { color: #950995;
font-family: sans-serif;
text-decoration: none;}
A.topic010 { color: #390A98;
font-family: sans-serif;
text-decoration: none;}
H1 { font-family: sans-serif;}
H2 { font-family: sans-serif;}
H3 { font-family: sans-serif;}
H4 { font-family: sans-serif;}
H5 { font-family: sans-serif;}
H6 { font-family: sans-serif;}
</style>
</head>
<body bgcolor="#FFFFFF" link="#006890" vlink="#003860" alink="#800000" text="#000000">
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/header0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<img src="_pic_/logo.gif" width=157 height=53 border=0 alt="Server for Information Technologies">
</td><td align="right">
<font size="-2">Сервер поддерживается<br><a class="plain" href="http://www.citmgu.ru">Центром Информационных Технологий</a><br>(095) 932-9212, 932-9213, 939-0783<br>E-mail: <a class=noneline href="mailto:info@citmgu.ru?Subject='From page topic CIT FORUM local copy'">info@citforum.ru</a></font>
</td></tr>
</table>
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<font size="-1">Сервер содержит море(!) аналитической информации</font>
</td><td align="right">
<font size="-1">CIT Forum CD-ROM</font>
</td></tr>
</table>
</td></tr>
</table>
<h3 align=center>MONITOR(3C)</h3>
<p align=justify><b>НАЗВАНИЕ</b><br>
monitor - подготовка временного профиля программы
<p><b>СИНТАКСИС</b>
<pre>
	#include &lt;mon.h>
	
	void monitor (lowpc, highpc, buffer, bufsize, nfunc)
	int (*lowpc)( ), (*highpc)( );
	WORD *buffer;
	int bufsize, nfunc;
</pre>
<p align=justify><b>ОПИСАНИЕ</b><br>
В  выполняемую  программу, полученную с помощью команды
cc -p, автоматически вставляются вызовы функции monitor
с  подразумеваемыми  значениями  аргументов;  явно  эту
функцию  следует  вызывать  только  тогда,  когда нужно
иметь возможность тонкого управления профилированием.
<p align=justify>Функция  monitor представляет собой интерфейс к системному вызову <a href=PROFIL.htm>profil(2)</a>. Аргументы lowpc и highpc являются адресами двух функций; buffer - это адрес (пользовательского) массива элементов типа WORD  (тип  определен
во  включаемом  файле  &lt;mon.h>), длина массива задается
аргументом bufsize. Функция monitor организует запись в
массив buffer гистограммы значений периодически опрашиваемого счетчика команд, а также счетчиков числа  вызовов  некоторых  функций.  Диапазон фиксируемых значений
счетчика команд простирается от lowpc  (нижний  предел)
до highpc (диапазон кончается перед этим адресом). Нижний предел lowpc должен быть отличен от нуля. Храниться
может не более nfunc счетчиков вызовов; фиксируются вызовы только тех функций, которые были откомпилированы с
опцией профилирования -p команды <a href=CC.htm>cc(1)</a>.
<p align=justify>Чтобы результаты измерений давали представление  о  реальной ситуации, особенно когда есть небольшие, но часто  используемые  функции,  надо,  чтобы размер массива
buffer был сравнимым с отслеживаемым  диапазоном  адресов.
<p align=justify>Для подготовки временного профиля всей программы достаточно следующей конструкции:
<pre>
	extern etext;
	  ...
	monitor ((int (*)()) 2, &etext, buf, bufsize, nfunc);
</pre>
<p align=justify>Объект etext лежит непосредственно за сегментом  команд
[см. <a href=END.htm>end(3C)</a>].
<p align=justify>Чтобы  прекратить профилирование и записать результаты,
следует использовать обращение
<pre>
	monitor((int (*)()) 0, 0, 0, 0, 0);
</pre>
<p align=justify>Затем для просмотра результатов  можно  воспользоваться
командой <a href=PROF~1.htm>prof(1)</a>.
<p align=justify>С помощью переменной окружения PROFDIR можно  управлять
именем  выходного файла функции monitor. Если такой переменной нет, то  в  текущем  каталоге  создается  файл
mon.out.  Если переменная существует, но значения у нее
нет, то monitor не профилирует программу и  не  создает
выходной  файл.  В  противном случае создается выходной
файл с именем  $PROFDIR/идентификатор_процесса.mon.out.
При  автоматическом вызове процедуры monitor после компиляции по команде cc -p  выходной  файл  получает  имя
$PROFDIR/идентификатор_процесса.имя_программы.
<p><b>ФАЙЛЫ</b>
<pre>
	mon.out
</pre>
<p><b>СМ. ТАКЖЕ</b><br>
<a href=PROFIL.htm>profil(2)</a>, <a href=END.htm>end(3C)</a>.<br>
<a href=CC.htm>cc(1)</a>, <a href=PROF~1.htm>prof(1)</a> в Справочнике пользователя.
<p align=justify><b>СЮРПРИЗЫ </b><br>
Форма
<pre>
	$PROFDIR/идентификатор_процесса.mon.out
</pre>
не работает. Работает автоматическая форма
<pre>
	$PROFDIR/идентификатор_процесса.имя_программы
</pre>
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/footer0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="right" valign="top" width="33%">
<font size="-2">Comments: <a class="plain" href="mailto:info@citmgu.ru?Subject='From bottom of CIT FORUM local copy'">info@citmgu.ru</a><br>
Designed by <a class="plain" href="mailto:andrey@novikov.com">Andrey Novikov</a><br>
Copyright &copy; <a class="plain" href="http://www.citmgu.ru/">CIT</a></font>
</td></tr>
</table>
</td></tr>
</table>
</body>
</html>