<html>
<head>
<title>MKSHLIB(1)</title>
		    <style type="text/css">
TH.arial { font-family: Arial, Serif;}
P.topic { font-family: sans-serif;}
A.plain { text-decoration: none;}
A.topic01 { color: #006890;
font-family: sans-serif;
text-decoration: none;}
A.topic02 { color: #099771;
font-family: sans-serif;
text-decoration: none;}
A.topic03 { color: #719709;
font-family: sans-serif;
text-decoration: none;}
A.topic04 { color: #98650A;
font-family: sans-serif;
text-decoration: none;}
A.topic05 { color: #98340A;
font-family: sans-serif;
text-decoration: none;}
A.topic06 { color: #099607;
font-family: sans-serif;
text-decoration: none;}
A.topic07 { color: #9E1215;
font-family: sans-serif;
text-decoration: none;}
A.topic08 { color: #970941;
font-family: sans-serif;
text-decoration: none;}
A.topic09 { color: #950995;
font-family: sans-serif;
text-decoration: none;}
A.topic010 { color: #390A98;
font-family: sans-serif;
text-decoration: none;}
H1 { font-family: sans-serif;}
H2 { font-family: sans-serif;}
H3 { font-family: sans-serif;}
H4 { font-family: sans-serif;}
H5 { font-family: sans-serif;}
H6 { font-family: sans-serif;}
</style>
</head>
<body bgcolor="#FFFFFF" link="#006890" vlink="#003860" alink="#800000" text="#000000">
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/header0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<img src="_pic_/logo.gif" width=157 height=53 border=0 alt="Server for Information Technologies">
</td><td align="right">
<font size="-2">Сервер поддерживается<br><a class="plain" href="http://www.citmgu.ru">Центром Информационных Технологий</a><br>(095) 932-9212, 932-9213, 939-0783<br>E-mail: <a class=noneline href="mailto:info@citmgu.ru?Subject='From page topic CIT FORUM local copy'">info@citforum.ru</a></font>
</td></tr>
</table>
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<font size="-1">Сервер содержит море(!) аналитической информации</font>
</td><td align="right">
<font size="-1">CIT Forum CD-ROM</font>
</td></tr>
</table>
</td></tr>
</table>

<h3 align=center>MKSHLIB(1)</h3>
<p align=justify><b>НАЗВАНИЕ</b><br>
mkshlib - создание разделяемой библиотеки
<p><b>СИНТАКСИС</b>
<pre>
    mkshlib  -s файл_спецификаций [-t библ_выполнения] [-h библ_сборки]
       [-n] [-L каталог] [-q]
</pre>
<p align=justify><b>ОПИСАНИЕ</b><br>
Команда mkshlib создает как разделяемые библиотеки  выполнения, так и разделяемые библиотеки сборки. Разделяемая  библиотека очень похожа на обычную, неразделяемую
об ектную библиотеку, но отличается тем, что программы,
собранные с разделяемой библиотекой, будут во время выполнения пользоваться одним и тем же экземпляром секций
команд библиотечных подпрограмм, тогда как в случае неразделяемых библиотек в каждом  процессе  имеется  своя
копия библиотечных подпрограмм.
<p align=justify>Разделяемая библиотека сборки - это архив, который  используется  при редактировании связей между программами
пользователя и разделяемой библиотекой [см.  <a href=AR~1.htm>ar(4)</a>].  С
разделяемой библиотекой сборки можно работать точно так
же,  как  и  с неразделяемой, она может обычным образом
включаться в команду <a href=CC.htm>cc(1)</a>. Кроме того,  все  операции,
которые  можно выполнять над архивом, могут быть выполнены и над разделяемой библиотекой сборки.
<p align=justify>Разделяемая библиотека выполнения - это выполняемый модуль, который присоединяется к процессу пользователя во
время выполнения  программы,  использующей  разделяемую
библиотеку.  Разделяемая библиотека выполнения содержит
секции команд всех подпрограмм  библиотеки;  в  ней  не
должно быть неразрешенных ссылок. Разделяемая библиотека  выполнения будет загружена в память во время выполнения программы, использующей разделяемую библиотеку, и
другие  процессы,  использующие ту же библиотеку, будут
разделять уже загруженные в память  секции  команд,  но
каждый процесс будет иметь свою копию секции данных.
<p align=justify>Интерфейс  пользователя  с  командой mkshlib состоит из
опций командной строки и файла спецификаций,  описывающего содержимое разделяемой библиотеки.
<p align=justify>Команда mkshlib производит вызов других программ, таких
как  <a href=AR.htm>ar(1)</a>, <a href=AS.htm>as(1)</a>, <a href=LD.htm>ld(1)</a>. Обращение к другим программам
происходит с  помощью  системного  вызова  execvp  [см.
<a href=EXEC.htm>exec(2)</a>],  который ищет нужную программу в каталогах из
списка поиска, хранящегося в переменной  PATH.  Команда
mkshlib  обрабатывает  префиксы  так  же, как и команда
<a href=CC.htm>cc(1)</a>; все программы, к которым производится обращение,
получают тот же префикс. Например,  pfxmkshlib  вызовет
pfxld.
<p align=justify>Команда mkshlib распознает следующие опции:
<dl>
<dt>-s файл_спецификаций <dd>
Указывает  файл спецификаций разделяемой библиотеки. Этот файл содержит информацию, необходимую для
построения разделяемой библиотеки. В нем находятся
спецификации  таблицы  переходов  для  разделяемой
библиотеки выполнения, маршрутное имя файла, в котором должна находиться разделяемая библиотека выполнения,  начальные адреса секции команд и секции
данных для разделяемой библиотеки выполнения, спецификации инициализации для разделяемой библиотеки
сборки и список об ектных файлов,  которые  должны
быть включены в разделяемую библиотеку (подробности см. ниже).
<p><dt>-t библ_выполнения <dd>
Указывает файл, в который будет помещена создаваемая  разделяемая  библиотека выполнения. Для того,
чтобы воспользоваться разделяемой библиотекой  выполнения,  ее  необходимо  переместить в то место,
которое указано в файле спецификации (см. ниже директиву #target). Если используется опция -n,  генерации  разделяемой библиотеки выполнения не производится.
<p><dt>-h библ_сборки <dd>
Указывает файл, в который будет помещена создаваемая разделяемая библиотека сборки. Если эта  опция
не указана, генерации разделяемой библиотеки сборки не производится.
<p><dt>-n <dd>  Не генерировать разделяемую библиотеку выполнения.
Эта опция используется  для  того,  чтобы  создать
только  разделяемую  библиотеку сборки. Тем не менее, следует обязательно указывать и опцию -t, так
как для  создания  разделяемой  библиотеки  сборки
требуется  версия  разделяемой библиотеки выполнения.
<p><dt>-L каталог ... <dd>
Изменить алгоритм поиска для разделяемых библиотек
сборки, указанных директивой #objects noload, так,
что поиск вначале производится в указанном каталоге, а только потом в каталогах по умолчанию. Опция
-L может быть указана в командной строке несколько
раз, при этом каталоги просматриваются в указанном
порядке перед поиском в каталогах по умолчанию.
<p><dt>-q <dd>  Не выдавать предупреждающих сообщений.  Эта  опция
используется, если известно, что будет выдано множество ненужных предупреждений.
</dl>
<p align=justify>Файл  спецификаций  разделяемой библиотеки содержит информацию, необходимую для создания как разделяемой библиотеки сборки, так и разделяемой  библиотеки  выполнения.  Содержимое  и  формат файла спецификаций задается
директивами, перечисленными ниже.
<p align=justify>Каждая  директива, за которой может следовать несколько
строк спецификаций, действует до тех пор, пока  не  закончится файл или не встретится другая директива.
<dl>
<dt>#address секция адрес <dd>
Указывает  начальный адрес секции разделяемой библиотеки выполнения. Эта директива обычно используется для задания начальных адресов секций .text  и
.data.
<p><dt>#target маршрутное_имя <dd>
Задает  маршрутное_имя  разделяемой библиотеки выполнения во время ее использования. Указанное  имя
записывается в файлы типа a.out(4), обращающиеся к
разделяемой библиотеке, и служит операционной системе  для поиска разделяемой библиотеки, когда она
требуется выполняемому файлу.
<p><dt>#branch <dd>
Указывает на начало спецификаций  таблицы  переходов. Строки, следующие за этой директивой, трактуются  как  строки  спецификации таблицы переходов.
Строки спецификации таблицы переходов имеют следующий формат:
<pre>
   имя_функции пробел_или_табуляция позиция
</pre>
где имя_функции - это имя, для  которого  задается
точка  входа в таблицу переходов, а позиция задает
позицию этой точки входа. Позиция может быть целым
числом или диапазоном целых чисел в формате  позиция1-позиция2. Каждая позиция должна быть не меньше  1;  одна и та же позиция не может быть указана
дважды; в таблице переходов не должно быть  пропущенных  позиций  (каждое  число от 1 до некоторого
максимального должно быть обязательно задействовано).
<p align=justify>Если для имени выделяется более одной точки  входа
путем  спецификации для него диапазона позиций или
путем указания одного и того  же  имени  в  разных
строках спецификации таблицы переходов, то используется максимальная из выделенных позиций. Все остальные позиции таблицы переходов могут рассматриваться  как пустые, в которые в новых версиях разделяемой  библиотеки  могут  быть  занесены  новые
функции.
<p><dt>#objects<dd>
Указывает  имена  об ектных  модулей, составляющих
разделяемую библиотеку выполнения. Строки, следующие за этой директивой, рассматриваются как список
об ектных файлов, в том  порядке,  в  котором  они
должны быть загружены в разделяемую библиотеку выполнения. Список состоит из имен файлов, разделяемых  пробелами или табуляциями. Этот же список используется для определения  об ектных  файлов  для
разделяемой  библиотеки  сборки,  но  порядок их в
разделяемой библиотеке сборки определяется пропуском списка через <a href=LORDER.htm>lorder(1)</a> и <a href=TSORT.htm>tsort(1)</a>. Эта  директива может встретиться в файле спецификаций разделяемой библиотеки только однажды.
<p><dt>#objects noload<dd>
За данной директивой следует список имен разделяемых библиотек сборки. Эти библиотеки  просматриваются  в  том  порядке,  в котором они указаны, для
разрешения ссылок из создаваемой разделяемой  библиотеки.  При  этом  ситуация, когда неразделяемая
версия  об екта обнаруживается раньше разделяемой,
трактуется как ошибочная.
<p align=justify>Имя  разделяемой  библиотеки  сборки  задается как
маршрутное имя файла или как  аргумент  вида  -lX,
где libX.a является именем файла в каталоге LIBDIR
или LLIBDIR. Описываемая ситуация аналогична ситуации с <a href=LD.htm>ld(1)</a>, и для задания других каталогов поиска библиотек можно воспользоваться опцией -L.
<p align=justify>Отметим, что если  с  помощью  директивы  #objects
noload указана разделяемая библиотека сборки, то в
каждой команде cc, редактирующей связи с создаваемой  разделяемой библиотекой, нужно также задавать
упомянутую разделяемую библиотеку сборки.
<p><dt>#hide linker [*] <dd>
Эта директива делает внешние имена локальными  для
создаваемой  разделяемой библиотеки. В последующих
строках могут задаваться регулярные выражения [см.
<a href=SH.htm>sh(1)</a>, <a href=FIND.htm>find(1)</a>], и если внешнее имя  соответствует
хотя  бы  одному  из выражений, оно становится локальным. Оставить некоторые имена внешними можно с
помощью директивы #export (см. ниже). Необязательный аргумент * эквивалентен последовательности
<pre>
      #hide linker *
</pre>
и приводит к тому, что все внешние имена становятся локальными.
<p align=justify>Все имена, использованные  в  директивах  #init  и
#branch,  всегда являются внешними и не могут быть
сделаны локальными с помощью директивы #hide.
<p><dt>#export linker [*] <dd>
В последующих  строках  могут  задаваться  внешние
имена, которые из-за соответствия регулярным выражениям  директивы #hide могли бы стать локальными.
Например, последовательность директив
<pre>
   #hide linker *
   #export linker
   one
   two
</pre>
приводит к тому, что все имена, кроме one и two, а
также тех, которые упомянуты в директивах #init  и
#branch, становятся локальными.
<p><dt>#init об ектный_файл <dd>
Указывает  об ектный файл, который требует инициализации. Строки,  следующие  за  этой  директивой,
рассматриваются  как строки спецификации инициализации, которые должны иметь следующий формат:
<pre>
   указатель пробел_или_табуляция имя
</pre>
где указатель - это указатель на внешнее имя; указатель должен быть  определен  в  об ектном_файле.
Для  каждой такой строки генерируются команды инициализации вида:
<pre>
   указатель=&имя;
</pre>
Повторная инициализация указателей не допускается,
так же, как и  повторное  использование  директивы
#init для того же об ектного_файла.
<p><dt>#ident цепочка_символов <dd>
Задает цепочку_символов, которая будет включена  в
секцию комментариев (.comment) разделяемой библиотеки выполнения.
<p><dt>##  <dd> Комментарий.  Строки, начинающиеся с ##, игнорируются.
</dl>
<p><b>ФАЙЛЫ</b>
<pre>
   LIBDIR          Обычно /lib.
   LLIBDIR         Обычно /usr/lib.
   TMPDIR/*        Временные файлы.
</pre>
<p align=justify>Обычно каталог TMPDIR -  это  /usr/tmp,  однако  данное
соглашение можно изменить, присвоив переменной  окружения   TMPDIR   другое   значение   [см.   tempnam( )  в
<a href=TMPNAM.htm>tmpnam(3S)</a>].
<p><b>СМ. ТАКЖЕ</b><br>
<a href=AR.htm>ar(1)</a>, <a href=AS.htm>as(1)</a>, <a href=CC.htm>cc(1)</a>, <a href=LD.htm>ld(1)</a>, <a href=LORDER.htm>lorder(1)</a>, <a href=TSORT.htm>tsort(1)</a>.
a.out(4), <a href=AR~1.htm>ar(4)</a> в Справочнике программиста.
<p align=justify><b>ОГРАНИЧЕНИЯ </b><br>
Опцию  -n нельзя использовать одновременно с директивой
#objects  noload.  Если  указать разделяемую библиотеку
сборки, которая уже существует, то mkshlib обновит ее с
помощью команды ar -ru. Следовательно,  если  удаляется
или переименовывается об ектный файл, включенный в разделяемую  библиотеку сборки, то перед обновлением нужно
обязательно удалить разделяемую библиотеку сборки.
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/footer0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="right" valign="top" width="33%">
<font size="-2">Comments: <a class="plain" href="mailto:info@citmgu.ru?Subject='From bottom of CIT FORUM local copy'">info@citmgu.ru</a><br>
Designed by <a class="plain" href="mailto:andrey@novikov.com">Andrey Novikov</a><br>
Copyright &copy; <a class="plain" href="http://www.citmgu.ru/">CIT</a></font>
</td></tr>
</table>
</td></tr>
</table>
</body>
</html>
