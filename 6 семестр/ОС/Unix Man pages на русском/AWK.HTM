<html>
<head>
<title>AWK(1)</title>
		    <style type="text/css">
TH.arial { font-family: Arial, Serif;}
P.topic { font-family: sans-serif;}
A.plain { text-decoration: none;}
A.topic01 { color: #006890;
font-family: sans-serif;
text-decoration: none;}
A.topic02 { color: #099771;
font-family: sans-serif;
text-decoration: none;}
A.topic03 { color: #719709;
font-family: sans-serif;
text-decoration: none;}
A.topic04 { color: #98650A;
font-family: sans-serif;
text-decoration: none;}
A.topic05 { color: #98340A;
font-family: sans-serif;
text-decoration: none;}
A.topic06 { color: #099607;
font-family: sans-serif;
text-decoration: none;}
A.topic07 { color: #9E1215;
font-family: sans-serif;
text-decoration: none;}
A.topic08 { color: #970941;
font-family: sans-serif;
text-decoration: none;}
A.topic09 { color: #950995;
font-family: sans-serif;
text-decoration: none;}
A.topic010 { color: #390A98;
font-family: sans-serif;
text-decoration: none;}
H1 { font-family: sans-serif;}
H2 { font-family: sans-serif;}
H3 { font-family: sans-serif;}
H4 { font-family: sans-serif;}
H5 { font-family: sans-serif;}
H6 { font-family: sans-serif;}
</style>
</head>
<body bgcolor="#FFFFFF" link="#006890" vlink="#003860" alink="#800000" text="#000000">
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/header0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<img src="_pic_/logo.gif" width=157 height=53 border=0 alt="Server for Information Technologies">
</td><td align="right">
<font size="-2">Сервер поддерживается<br><a class="plain" href="http://www.citmgu.ru">Центром Информационных Технологий</a><br>(095) 932-9212, 932-9213, 939-0783<br>E-mail: <a class=noneline href="mailto:info@citmgu.ru?Subject='From page topic CIT FORUM local copy'">info@citforum.ru</a></font>
</td></tr>
</table>
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<font size="-1">Сервер содержит море(!) аналитической информации</font>
</td><td align="right">
<font size="-1">CIT Forum CD-ROM</font>
</td></tr>
</table>
</td></tr>
</table>

<h3 align=center>AWK(1)</h3>
<p align=justify><b>НАЗВАНИЕ</b><br>
awk - сопоставление с шаблонами и преобразование текста
<p><b>СИНТАКСИС</b>
<pre>
  awk  [-Fсимвол] [[-f] программа] [аргумент ...] [файл ...]
</pre>
<p align=justify><b>ОПИСАНИЕ</b><br>
Команда awk сопоставляет строки исходных файлов с  шаблонами, определенными в программе. Шаблоны можно задать
либо непосредственно в командной строке, либо поместить
в файл с именем программа и воспользоваться опцией  -f.
Если шаблоны указаны в  командной  строке,  их  следует
заключить в одинарные кавычки ('), чтобы  избежать  интерпретации shell'ом.
<p align=justify>
Команде  awk могут быть переданы аргументы в виде x=...
y=... и т.д. (см. ПРИМЕРЫ).
<p align=justify>
Файлы читаются в том порядке, как они заданы.  Если  не
указано ни одного файла или задано имя -,  используется
стандартный ввод. Ввод для awk делится на записи,  разделяемые специальным символом. По умолчанию это перевод
строки; в таком случае awk обрабатывает ввод построчно.
Разделитель записей можно изменить, переопределив переменную RS. Каждая запись делится на поля,  ограниченные
разделителями полей (по умолчанию  -  пробелами).  Этот
разделитель можно изменить, переопределив переменную FS
или указав флаг -Fсимвол. Поля исходных строк  доступны
по именам $1, $2,...; $0 - вся входная строка.
<p align=justify>
Для каждого шаблона из программы может быть задано действие, которое будет произведено со всякой строкой, успешно сопоставленной с шаблоном. Оператор шаблон-действие имеет вид:
<pre>
   шаблон { действие }
</pre>
Каждая исходная строка сопоставляется с каждым из  шаблонов; в случае успеха выполняются указанные  действия.
После сопоставления со всеми шаблонами вводится следующая строка и процесс сопоставления  повторяется.  Может
быть опущен либо шаблон, либо действие, но не оба вместе. Если для данного шаблона не  указаны  действия,  то
строка просто копируется на стандартный вывод. Если для
действия не определен шаблон, то оно будет  выполняться
для каждой входной строки. Строки, которые  не  удалось
сопоставить ни одному шаблону, игнорируются.
<p align=justify>
Действие есть последовательность  операторов.  Так  как
шаблоны и действия могут быть опущены, то, чтобы различать их в программе, последние надо  брать  в  фигурные
скобки. Оператор есть одна из конструкций:
<pre>
   if ( условие ) оператор [ else оператор ]
   while ( условие ) оператор
   for ( выражение; условие; выражение ) оператор
   break
   continue
   { [ оператор ] ... }
   переменная = выражение
   print [ список_выражений ] [&gt; выражение ]
   printf формат [, список_выражений ] [&gt; выражение ]
   next  # пропустить оставшиеся шаблоны и перейти к
   следующей строке
   exit  # пропустить оставшиеся строки
</pre><p align=justify>
Операторы завершаются точкой с запятой, переводом строки или правой скобкой. Пустой список_выражений означает
всю строку. Выражения строятся из  цепочек  символов  и
чисел с помощью операций +, -, *, /, %  и  конкатенации
(обозначается пробелом). В выражениях также  можно  использовать операции из языка C: ++, --, +=, -=, *=, /=,
%=. Переменные инициализируются пустыми цепочками.  Переменные  могут  быть  скалярами,  элементами   массива
(обозначается x[i]) или полями. Индексами массива могут
служить любые (не обязательно числовые) цепочки  символов, что позволяет реализовать  разновидность  ассоциативной памяти. Цепочки символов заключаются  в  двойные
кавычки (").
<p align=justify>
Оператор print выдает свои аргументы на стандартный вывод (или в файл, если присутствует  часть  &gt;выражение),
разделяя их текущим разделителем полей и завершая  каждую  запись  выходным разделителем  записей.   Оператор
printf делает то же самое, но под  управлением  формата
[см. <a href=PRINTF.htm>printf(3S)</a>].
<p align=justify>
Встроенная функция length возвращает длину своего аргумента, рассматривая его как цепочку символов; если  аргумент опущен, то возвращается  длина  текущей  строки.
Определены также  следующие  встроенные  функции:  exp,
log, sqrt и int (int отбрасывает дробную  часть  своего
аргумента). Функция substr(s, m, n)  возвращает  n-символьную подцепочку цепочки s, начинающуюся с позиции m.
Функция sprintf(формат, выражение, выражение,...)  преобразует выражения в соответствии с указанным  форматом
[см. <a href=PRINTF.htm>printf(3S)</a>] и возвращает полученную цепочку символов.
<p align=justify>
Шаблон - это произвольная логическая  комбинация,  составленная с помощью операций !, ||, && и скобок из  регулярных выражений и  выражений  сравнения.  Регулярные
выражения  обрамляются  символами  /   [подробнее   см.
<a href=EGREP.htm>egrep(1)</a>]. Отдельное регулярное выражение в шаблоне сопоставляется со всей строкой. Регулярные выражения  могут входить и в выражения сравнения. Шаблон может  состоять из двух шаблонов, разделенных запятой;  при  этом
указанные действия выполняются  для  всех  строк  между
строкой, удовлетворяющей первому  шаблону,  и  строкой,
удовлетворяющей второму шаблону.
<p align=justify>
Выражение сравнения - это одна из  следующих  конструкций:
<pre>
   выражение  опер_сопост  регулярное_выражение
   выражение  опер_сравн  выражение
</pre><p align=justify>
где опер_сравн - любая из шести операций сравнения языка C, опер_сопост это ~ (содержится) или !~ (не  содержится).
<p align=justify>
Условие - это арифметическое выражение, выражение сравнения или их логическая комбинация.
<p align=justify>
Для выполнения каких-либо  действий  перед  первой  или
после последней строки определены  специальные  шаблоны
BEGIN и END. BEGIN должен быть первым шаблоном,     END
- последним.  Например,  для  использования символа c в
качестве разделителя полей можно либо  запустить  программу с опцией -Fc, либо указать
<pre>
   BEGIN { FS = c }
</pre>
Остальные специальные переменные:
<dl>
<dt>NF
<dd>Количество полей в текущей записи.
<dt>NR
<dd>Порядковый номер текущей записи.
<dt>FILENAME
<dd>Имя файла, из которого в данный момент производится ввод.
<dt>OFS
<dd>Разделитель полей при выводе, по умолчанию пробел.
<dt>ORS
<dd>Разделитель записей при выводе, по умолчанию перевод строки.
<dt>OFMT Формат вывода чисел, по умолчанию %.6g.
</dl>
<p><b>ПРИМЕРЫ</b><ol>
<li>Вывести строки файла f1, содержащие более 72 символов:
<pre>
   awk  'length &gt; 72' f1
</pre>
<li>Вывести первые два поля файла f2 в обратном порядке:
<pre>
   awk  '{ print $2, $1 }' f2
</pre>
<li>Сложить числа, стоящие в первом  столбце  файла  f3,
вывести сумму и среднее арифметическое:<br>
В файле prog:
<pre>
{ s += $1 }
   END  { print "sum is", s, " average is", s/NR }
</pre>
Командная строка:
<pre>
   awk -f prog f3
</pre>
<li>Вывести поля файла f4 в обратном порядке:
<pre>
   awk  '{ for (i = NF; i &gt; 0; --i) print $i }' f4
</pre>
<li>Вывести все строки файла f5, находящиеся между парами start/stop
<pre>
   awk  '/start/,/stop/' f5
</pre>
<li>Вывести те строки файла f6, у которых первое поле не
совпадает с первым полем предыдущей строки:
<pre>
   awk  '$1 != prev { print; prev = $1 }' f6
</pre>
<Li>Распечатать файл f7, вставляя после слова "Page" номер страниц, начиная с пятой:
<br>
В файле prog:
<pre>
   /Page/ { $2 = n++ }
  { print }
</pre>
Командная строка:
<pre>
   awk  -f prog n=5 f7
</pre>
</ol>
<p align=justify><b>СМ. ТАКЖЕ</b><br>
<a href=EGREP.htm>egrep(1)</a>, <a href=LEX.htm>lex(1)</a>, <a href=SED.htm>sed(1)</a>.<br>
<a href=PRINTF.htm>printf(3S)</a> в Справочнике программиста.
<p align=justify><b>СЮРПРИЗЫ</b><br>
Входные пробелы не сохраняются при  выводе,  если  поля
этой записи подвергались изменениям.
<p align=justify>
В языке команды awk  отсутствуют  явные  преобразования
между  цепочками  символов  и  числами. Чтобы выражение
трактовалось как число, прибавьте к нему 0; чтобы трактовалось как цепочка - сконкатенируйте его с пустой цепочкой ""
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/footer0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="right" valign="top" width="33%">
<font size="-2">Comments: <a class="plain" href="mailto:info@citmgu.ru?Subject='From bottom of CIT FORUM local copy'">info@citmgu.ru</a><br>
Designed by <a class="plain" href="mailto:andrey@novikov.com">Andrey Novikov</a><br>
Copyright &copy; <a class="plain" href="http://www.citmgu.ru/">CIT</a></font>
</td></tr>
</table>
</td></tr>
</table>
</body>
</html>
