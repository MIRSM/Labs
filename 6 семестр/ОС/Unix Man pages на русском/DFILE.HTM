<html>
<head>
<title>DFILE(4)</title>
		    <style type="text/css">
TH.arial { font-family: Arial, Serif;}
P.topic { font-family: sans-serif;}
A.plain { text-decoration: none;}
A.topic01 { color: #006890;
font-family: sans-serif;
text-decoration: none;}
A.topic02 { color: #099771;
font-family: sans-serif;
text-decoration: none;}
A.topic03 { color: #719709;
font-family: sans-serif;
text-decoration: none;}
A.topic04 { color: #98650A;
font-family: sans-serif;
text-decoration: none;}
A.topic05 { color: #98340A;
font-family: sans-serif;
text-decoration: none;}
A.topic06 { color: #099607;
font-family: sans-serif;
text-decoration: none;}
A.topic07 { color: #9E1215;
font-family: sans-serif;
text-decoration: none;}
A.topic08 { color: #970941;
font-family: sans-serif;
text-decoration: none;}
A.topic09 { color: #950995;
font-family: sans-serif;
text-decoration: none;}
A.topic010 { color: #390A98;
font-family: sans-serif;
text-decoration: none;}
H1 { font-family: sans-serif;}
H2 { font-family: sans-serif;}
H3 { font-family: sans-serif;}
H4 { font-family: sans-serif;}
H5 { font-family: sans-serif;}
H6 { font-family: sans-serif;}
</style>
</head>
<body bgcolor="#FFFFFF" link="#006890" vlink="#003860" alink="#800000" text="#000000">
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/header0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<img src="_pic_/logo.gif" width=157 height=53 border=0 alt="Server for Information Technologies">
</td><td align="right">
<font size="-2">Сервер поддерживается<br><a class="plain" href="http://www.citmgu.ru">Центром Информационных Технологий</a><br>(095) 932-9212, 932-9213, 939-0783<br>E-mail: <a class=noneline href="mailto:info@citmgu.ru?Subject='From page topic CIT FORUM local copy'">info@citforum.ru</a></font>
</td></tr>
</table>
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<font size="-1">Сервер содержит море(!) аналитической информации</font>
</td><td align="right">
<font size="-1">CIT Forum CD-ROM</font>
</td></tr>
</table>
</td></tr>
</table>

<h3 align=center>DFILE(4)</h3>
<p><b>НАЗВАНИЕ</b><br>
dfile - файл с информацией об устройствах
<p align=justify><b>ОПИСАНИЕ</b><br>
Файл устройств, dfile, содержит информацию об устройствах,  входящих  в  систему.  Файл делится на три части.
Первая содержит спецификации физических устройств. Вторая - системно-зависимую информацию. Третья  часть  содержит  информацию, относящуюся к конкретному микропроцессору.  Первые  две  части  являются   обязательными,
третья  -  нет. Строка со звездочкой в начале или звездочкой, перед которой идут табуляции или пробелы, является комментарием.
<p align=justify>
Ниже  описываются три части файла устройств. В качестве
примера используется дисковый контроллер.
<p align=justify><i>Первая часть файла устройств</i><br>
Каждая строка состоит из четырех или пяти полей, разделенных  табуляциями  и/или  пробелами и имеет следующий
формат:
<pre>
     имя_устройства  вектор  адрес  уровень  число
</pre><p align=justify>
Имя_устройства задается так же, как в файле  <a href=MASTER.htm>master(4)</a>,
где  оно располагается в поле 1 строк из первой части и
состоит не более чем из 8 символов [см. <a href=MASTER.htm>master(4)</a>].
<p align=justify>
Вектор задает шестнадцатеричный адрес вектора  прерываний; это значение используется также в массиве векторов
прерываний,  который  создается  при указании буквы v в
поле 4 файла <a href=MASTER.htm>master(4)</a>.
<p align=justify>
Адрес является  шестнадцатеричным  адресом  устройства;
массив   адресов   устройств   создается  автоматически
(например, hd_addr [ ]).
<p align=justify>
Уровень - это уровень запроса шины или уровень прерываний (от 1 до 7). Он используется в массиве уровней прерываний (например, hd_ilev [ ]), который создается  при
указании  буквы  l  в  поле  4 строк первой части файла
<a href=MASTER.htm>master(4)</a>.
<p align=justify>
Пятое  поле, число - есть (десятичное) число устройств,
ассоциированных  с соответствующим  контроллером.  Поле
число - необязательное и, если оно опущено, используется значение по умолчанию, которое является максимальным
для  данного  контроллера.  Данное поле означает то же,
что и поле 9 строк первой  части  файла  <a href=MASTER.htm>master(4)</a>,  но
значение  из  файла  устройств  перекрывает значение из
файла <a href=MASTER.htm>master(4)</a>.
<p align=justify>
Имеется также несколько драйверов, которые  могут  поддерживаться  системой,  но  которые являются драйверами
псевдоустройств, то есть  нет  реального  оборудования,
ассоциированного  с  ними.  В  описании псевдоустройств
значения полей вектор, адрес  и  уровень_запроса  равны
нулю.
<p align=justify><i>Вторая часть файла устройств</i><br>
Вторая  часть  содержит  строки  шести различных типов.
Обязательны только строки первых четырех типов. Порядок
спецификаций может быть произвольным.
<ol>
<li>Спецификация устройств для корня, каналов и дампа<br>
Три  строки  по  три поля в каждой описывают устройства
для корневой файловой системы, для  создания  каналов и
для выдачи дампа при сбое системы:
<pre>
     root  имя_устройства  младший_номер
     pipe  имя_устройства  младший_номер
     dump  имя_устройства  младший_номер
</pre>
Младший_номер является восьмеричным.
<Li>Спецификация устройства для подкачки<br>
Одна строка с пятью полями задает  устройство,  которое
будет использоваться для подкачки:
<pre>
     swap  имя_устройства младший_номер нач_блок число
</pre>
Нач_блок есть блок диска (десятичный), с которого начинается  область подкачки; число задает размер области в
блоках.
<li>Спецификация типа файловой системы<br>
Несколько строк по пять полей в каждой содержат  описания типов файловых систем:
<pre>
     filesys  ид_1  флаг_1  ид_2  флаги_2
</pre>
Ид_1  есть  имя  типа файловой системы (не более чем из
четырех символов) в том виде, как оно  выдается  компонентом  fs_namei  (  )  структуры  fstypsw  [см.  &lt;sys/
conf.h&gt;].
<p>
Установленный флаг_1 означает, что после очередного обращения   к  описателю  файла  будет  вызван  компонент
fs_iput ( ) структуры fstypsw, что влияет на режим  буферизации.  Для файловых систем версии 5 этот флаг должен быть нулевым.
<p>
Ид_2 есть имя типа файловой системы (не  более  чем  из
восьми  символов) в том виде, как оно хранится в структуре fsinfo [см. &lt;sys/conf.h&gt;].
<p>
Если файловая система должна уведомляться  о  некоторых
действиях,  следует установить соответствующие флаги из
флагов_2.  Уведомление  состоит  в  вызове   компонента
fs_notify ( ) структуры fstypsw. Можно установить такие
флаги (или их комбинацию):
<table>
<tr><th>1<td>Изменение каталога.</tr>
<tr><th>2<td>Изменение корня.</tr>
<tr><th>4<td>Позиционирование.</tr>
</table>
<p>Например, строка
<pre>
     fylesys  s5  0  S51k  04
</pre>
описывает стандартную файловую систему версии 5.
<li>Спецификация режима работы с линией<br>
Несколько строк файла устройств по три  поля  в  каждой
описывают режимы работы с линией:
<pre>
     linemod  имя_режима  список_обработчиков
</pre>
Имя_режима состоит не более чем из четырех символов.
<p>
Список_обработчиков задается как цепочка символов. Буква  соответствует существующему обработчику, отсутствие
обозначается символом -. Могут задаваться следующие обработчики:
<table>
<tr valign=top><th>m<td>Обработка прерываний модема.</tr>
<tr valign=top><th>o<td>Обработка вывода.</tr>
<tr valign=top><th>i<td>Обработка ввода.</tr>
<tr valign=top><th>O<td>Обработка открытия.</tr>
<tr valign=top><th>C<td>Обработка закрытия.</tr>
<tr valign=top><th>R<td>Обработка чтения.</tr>
<tr valign=top><th>W<td>Обработка записи.</tr>
<tr valign=top><th>I<td>Обработка управления.</tr>
</table>
<p>Стандартный  режим задается как -oiOCRWI, то есть обрабатывать все, кроме прерываний модема.
<Li>Спецификация фактических параметров<br>
Каждый параметр, упомянутый в  файле  <a href=MASTER.htm>master(4)</a>,  может
получить (новое) значение. Строка спецификации параметра состоит из двух полей:
<pre>
     имя_параметра  значение
</pre>
Отметим,  что  все  параметры должны получить значение,
либо в файле <a href=MASTER.htm>master(4)</a>, либо в описываемом  файле  устройств.
<li>Спецификация модулей потоков 
Данная  спецификация  может  содержать несколько строк,
каждая из которых состоит из  трех  полей  и  описывает
один модуль потока:
<pre>
     stream  имя_модуля  имя_структуры
</pre>
Имя_модуля  задает  модуль потока, который может встречаться в команде I_PUSH системного вызова <a href=IOCTL.htm>ioctl(2)</a> [см.
<a href=STREAMIO.htm>streamio(7)</a>].
<p>
Имя_структуры есть  имя  указателя  на  структуру  типа
streamtab.  И имя_модуля, и имя_структуры должны состоять не более чем из восьми символов.
</ol>
<p align=justify><i>Третья часть файла устройств</i><br>
Третья часть содержит строки, каждая из которых начинается с определенного ключевого слова. Играет роль порядок этих строк.
<ol>
<li>Спецификация нестандартных драйверов<br>
Данная спецификация может содержать несколько строк  по
два поля в каждой:
<pre>
     force  идентификатор
</pre>
где  идентификатор есть имя уникального идентификатора,
определенного внутри драйвера, находящегося в библиотеке ввода/вывода ядра ОС. В результате при  редактировании связей будут правильно подключены нетаблично управляемые  драйверы,  такие, например, как драйверы часов,
консоли и устройства управления памятью.
<li>Спецификация сторонних обработчиков прерываний<br>
Данная спецификация может содержать несколько строк  по
три поля в каждой:
<pre>
     alien  адрес_вектора  сторонний_обработчик
</pre>
Адрес_вектора  есть  шестнадцатеричный  адрес  обычного
вектора прерываний, подлежащих дополнительной  обработке,  а  сторонний_обработчик задается шестнадцатеричным
адресом точки входа. Если с адресом_вектора не ассоциирован обработчик  прерываний,  то  сторонний_обработчик
помещается  в  вектор.  В  противном случае в программе
low.s порождаются команды [см. <a href=CONFIG.htm>config(1M)</a>], чтобы  сторонний_обработчик  получал управление, только если прерывание произошло в привилегированном режиме.
<li>Спецификация множественной обработки прерываний<br>
Данная спецификация может содержать несколько строк,  в
каждой из которых по четыре или пять полей:
<pre>
     dup  флаги  адрес_вектора  обработчик  аргумент
</pre>
Флаги представляют собой битную маску. Биты интерпретируются следующим образом:
<table>
<tr valign=top><th>1<td>Если  обработчик  вернул  0, перейти на нормальную
точку возврата из прерывания ("intret").</tr>
<tr valign=top><th>2<td>Если обработчик вернул 0,  перейти  на  нормальную
точку возврата из ловушки ("alltraps").</tr>
<tr valign=top><th>4<td>Если обработчик вернул 0, перейти на точку возврата по равенству ("beq return").</tr>
<tr valign=top><th>10<td>Программе обработки прерывания должен быть передан
аргумент.</tr>
</table>
<p>Адрес_вектора есть шестнадцатеричный адрес вектора прерываний. Обработчик - есть имя программы обработки прерываний с необязательным аргументом. Цель данной спецификации -  обеспечить  возможность  задания  нескольких
программ  обработки  для одного прерывания. Обработчики
вызываются в порядке их указания в файле устройств; затем вызывается нормальная программа обработки  прерываний.  Если биты 1, 2 или 4 флагов равны 1, а обработчик
вернул 0, оставшиеся обработчики не вызываются.
<li>Спецификация конфигурации памяти<br>
Данная  спецификация может содержать несколько строк, в
каждой из которых по четыре или пять полей:
<pre>
     ram  флаги  мин_адрес  макс_адрес  [размер]
</pre>
Флаги представляют собой битную маску. Биты интерпретируются следующим образом:
<table>
<tr valign=top><th>1<td>Память не имеет контроля четности и,  следовательно, не требует инициализации после включения питания.</tr>
<tr valign=top><th>2<td>Может  существовать  только единый блок памяти, от
мин_адреса до макс_адреса-1.</tr>
<tr valign=top><th>4<td>В диапазоне от мин_адреса до  макс_адреса-1  может
располагаться несколько блоков памяти, каждый указанного размера.</tr>
</table>
<p>Мин_адрес, макс_адрес и размер являются шестнадцатеричными. Цель данной спецификации - предоставить  ядру  ОС
информацию  о  конфигурации памяти, содержащей разрывы.
Мин_адрес определяет минимальный адрес, по которому может находиться память, макс_адрес-1 есть верхняя граница. Если в этих пределах содержится несколько плат  памяти,  часть которых может отсутствовать, каждая из них
должна иметь заданный размер.
<p>
Если память помечена флагами со значением  2,  ядро  ОС
осуществляет  запись в последовательные ячейки, начиная
с мин_адреса, пока не возникнет ошибка памяти. Если установлен флаг 4, ядро ОС проверяет  каждый  поддиапазон
указанного  размера. Если память не нуждается в инициализации, для  определения  наличия  памяти  проверяется
только  первый байт диапазона (флаг 2) или поддиапазона
(флаг 4).
<p>
Существенно, что строки,  специфицирующие  конфигурацию
памяти,  должны располагаться в порядке возрастания минимальных адресов. Если два минимальных адреса равны (в
диапазоне могут располагаться блоки памяти разного размера), строки должны быть  упорядочены  по  возрастанию
размеров.
</ol>
<p><b>ФАЙЛЫ</b><br>
<pre>
/usr/src/uts/dfile
/usr/src/uts/master
/usr/src/uts/low.s
/usr/src/uts/conf.c
/usr/include/sys/conf.h
</pre>
<p><b>СМ. ТАКЖЕ</b><br>
<a href=MASTER.htm>master(4)</a>.<br>
<a href=CONFIG.htm>config(1M)</a> в Справочнике администратора.
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/footer0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="right" valign="top" width="33%">
<font size="-2">Comments: <a class="plain" href="mailto:info@citmgu.ru?Subject='From bottom of CIT FORUM local copy'">info@citmgu.ru</a><br>
Designed by <a class="plain" href="mailto:andrey@novikov.com">Andrey Novikov</a><br>
Copyright &copy; <a class="plain" href="http://www.citmgu.ru/">CIT</a></font>
</td></tr>
</table>
</td></tr>
</table>
</body>
</html>
