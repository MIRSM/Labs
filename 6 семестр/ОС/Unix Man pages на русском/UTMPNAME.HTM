<html>
<head>
<title>GETUT(3C)</title>
		    <style type="text/css">
TH.arial { font-family: Arial, Serif;}
P.topic { font-family: sans-serif;}
A.plain { text-decoration: none;}
A.topic01 { color: #006890;
font-family: sans-serif;
text-decoration: none;}
A.topic02 { color: #099771;
font-family: sans-serif;
text-decoration: none;}
A.topic03 { color: #719709;
font-family: sans-serif;
text-decoration: none;}
A.topic04 { color: #98650A;
font-family: sans-serif;
text-decoration: none;}
A.topic05 { color: #98340A;
font-family: sans-serif;
text-decoration: none;}
A.topic06 { color: #099607;
font-family: sans-serif;
text-decoration: none;}
A.topic07 { color: #9E1215;
font-family: sans-serif;
text-decoration: none;}
A.topic08 { color: #970941;
font-family: sans-serif;
text-decoration: none;}
A.topic09 { color: #950995;
font-family: sans-serif;
text-decoration: none;}
A.topic010 { color: #390A98;
font-family: sans-serif;
text-decoration: none;}
H1 { font-family: sans-serif;}
H2 { font-family: sans-serif;}
H3 { font-family: sans-serif;}
H4 { font-family: sans-serif;}
H5 { font-family: sans-serif;}
H6 { font-family: sans-serif;}
</style>
</head>
<body bgcolor="#FFFFFF" link="#006890" vlink="#003860" alink="#800000" text="#000000">
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/header0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<img src="_pic_/logo.gif" width=157 height=53 border=0 alt="Server for Information Technologies">
</td><td align="right">
<font size="-2">Сервер поддерживается<br><a class="plain" href="http://www.citmgu.ru">Центром Информационных Технологий</a><br>(095) 932-9212, 932-9213, 939-0783<br>E-mail: <a class=noneline href="mailto:info@citmgu.ru?Subject='From page topic CIT FORUM local copy'">info@citforum.ru</a></font>
</td></tr>
</table>
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="left">
<font size="-1">Сервер содержит море(!) аналитической информации</font>
</td><td align="right">
<font size="-1">CIT Forum CD-ROM</font>
</td></tr>
</table>
</td></tr>
</table>
<h3 align=center>GETUT(3C)</h3>
<p align=justify><b>НАЗВАНИЕ</b><br>
getutent,  getutid,  getutline,  pututline,   setutent,
endutent, utmpname - доступ к utmp-файлу
<p><b>СИНТАКСИС</b>
<pre>
	#include &lt;sys/types.h>
	#include &lt;utmp.h>
	
	struct utmp *getutent ( )
	
	struct utmp *getutid (id)
	struct utmp *id;
	
	struct utmp *getutline (line)
	struct utmp *line;
	
	void pututline (utmp)
	struct utmp *utmp;
	
	void setutent ( )
	
	void endutent ( )
	
	void utmpname (file)
	char *file;
</pre>
<p align=justify><b>ОПИСАНИЕ</b><br>
Результатом функций getutent, getutid и getutline является указатель на структуру следующего типа:
<pre>
	struct utmp {
	  char ut_user[8];  /* Входное имя пользователя */
	  char ut_id[4];    /* Идентификатор  из  файла
	                  /etc/inittab (обычно номер линии) */
	  char ut_line[12]; /* Имя  устройства (console, tty xx) */
	  short ut_pid;     /* Идентификатор процесса */
	  short ut_type;    /* Тип элемента */
	  struct exit_status {
	    short e_termination; /* Системный  код   завершения
	                            процесса */
	    short e_exit;        /* Пользовательский код завер-
	                            шения */
	  } ut_exit;        /* Код  завершения  процесса, поме-
	                       ченного как DEAD_PROCESS */
	  time_t ut_time;   /* Время создания элемента */
	};
</pre>
<p align=justify>Функция getutent читает следующий элемент из файла типа
utmp. Если файл еще не открыт, он открывается. При достижении конца файла выполнение функции завершается неудачей.
<p align=justify>Функция getutid, начиная с текущей позиции, разыскивает
элемент utmp-файла, в котором поле ut_type соответствует значению id->ut_type. Если компонент id->ut_type равен RUN_LVL, BOOT_TIME, OLD_TIME, или NEW_TIME, то требуется   точное   равенство  типов. Если  же  компонент
id->ut_type    равен    INIT_PROCESS,    LOGIN_PROCESS,
USER_PROCESS, или DEAD_PROCESS, то функция getutid вернет указатель на первый элемент, тип которого равен одному  из четырех перечисленных, и поле ut_id соответствует значению id->ut_id.  Функция  getutid  завершается
неудачей, если ничего не находит до конца файла.
<p align=justify>Функция getutline, начиная с текущей позиции,  разыскивает    элемент    utmp-файла,   тип   которого   равен
LOGIN_PROCESS или USER_PROCESS, а  поле  ut_line  соответствует значению line->ut_line. Функция getutline завершается  неудачей,  если  ничего  не находит до конца
файла.
<p align=justify>Функция pututline записывает указанную utmp-структуру в
utmp-файл.  При этом для поиска нужного места используется функция getutid, если обнаруживается, что  текущая
позиция  не  является  подходящей.  Предполагается, что
пользователь, перед тем как обратиться к pututline, установил нужную текущую позицию с помощью одной из функций getut. Если это сделано, pututline не будет  производить  поиск.  Если pututline не обнаружит подходящего
места для нового элемента, элемент будет добавлен в конец файла.
<p align=justify>Функция  setutent устанавливает указатель текущей позиции  на начало файла. Это должно быть сделано перед поиском нового элемента, если предполагается,  что  поиск
должен проводиться во всем файле.
<p align=justify>Функция endutent закрывает открытый файл.
<p align=justify>Функция utmpname позволяет изменить имя обрабатываемого
файла  с /etc/utmp на любое другое. Предполагается, что
чаще всего этим другим  именем  будет  /etc/wtmp.  Если
файл  не существует, он не будет создаваться до первого
обращения к нему. Функция utmpname  не  отрывает  файл,
она только закрывает открытый файл и запоминает имя нового файла.
<p><b>ФАЙЛЫ </b><br>
<pre>
	/etc/utmp
	/etc/wtmp
</pre>
<p><b>СМ. ТАКЖЕ</b><br>
<a href=TTYSLOT.htm>ttyslot(3C)</a>, <a href=UTMP.htm>utmp(4)</a>.
<p align=justify><b>ДИАГНОСТИКА</b><br>
При  ошибке  ввода/вывода возвращается пустой указатель
(NULL). Ошибка чтения может  быть  вызвана  отсутствием
прав доступа или достижением конца файла.
<p align=justify><b>ПРИМЕЧАНИЯ </b><br>
Элемент, к которому было последнее обращение,  сохраняется в статической структуре, поэтому доступ к нескольким  элементам требует копирования структур. При каждом
обращении к getutid или getutline вначале анализируется
статическая структура. Если она оказывается подходящей,
никакого поиска  не  производится.  Чтобы  использовать
getutline  для  поиска нескольких вхождений, необходимо
очищать статическую структуру после  успешного  поиска,
иначе  getutline  будет  возвращать все время одно и то
же. Из правила очистки структуры перед последующим чтением есть одно  исключение.  Если  неявное  чтение  при
pututline  обнаруживает,  что  оно  находится на нужном
месте в файле,  то  содержимое  статической  структуры,
возвращаемой  getutent, getutid или getutline, не нужно
очищать, если пользователь только поменял ее содержимое
и передал указатель функции pututline.
<p align=justify>Все  функции пользуются стандартным буферизованным вводом/выводом, однако pututline использует  нестандартный
небуферизованный вывод, чтобы разрешить нескольким процессам модифицировать файлы utmp и wtmp.
<table cellspacing=0 cellpadding=0 border=0 background="_pic_/footer0.jpg" width="100%">
<tr><td align="center">
<table cellspacing=0 cellpadding=4 border=0 width="100%" background="">
<tr><td align="right" valign="top" width="33%">
<font size="-2">Comments: <a class="plain" href="mailto:info@citmgu.ru?Subject='From bottom of CIT FORUM local copy'">info@citmgu.ru</a><br>
Designed by <a class="plain" href="mailto:andrey@novikov.com">Andrey Novikov</a><br>
Copyright &copy; <a class="plain" href="http://www.citmgu.ru/">CIT</a></font>
</td></tr>
</table>
</td></tr>
</table>
</body>
</html>