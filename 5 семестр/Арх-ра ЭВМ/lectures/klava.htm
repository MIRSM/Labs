<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head> 
<title> КЛАВИАТУРА </title>
<META content="text/html; charset=windows-1251" http-equiv=Content-Type>
<META content="Demon" name=Author>
<BASE TARGET="main">
<style TYPE="TEXT/CSS">
h4.Y {color: red; font-family: arial}
h2.W {color: purple ; font-family: arial}
</STYLE>
<link rel="stylesheet" href="../images/styles.css" type="text/css">
</head>


<body bgcolor="#50BECD" link="#0000FC" vlink="#ffff00" text="#000000">
<h1 ALIGN="CENTER">КЛАВИАТУРА</H1>
<p>Клавиатура выполнена, как правило, в виде отдельного устройства, подключенного 
  к компьютеру кабелем. Переносные компьютеры Notebook используют встроенную клавиатуру. 
  Внутри клавиатуры установлен контроллер на базе однокристальной микроэвм, который 
  отслеживает нажатия на клавиши (сканирует клавиши) и посылает номер нажатой 
  клавиши в центральный компьютер. </p>
<p>Номер клавиши, посылаемый клавиатурным процессором, однозначно связан с распайкой 
  клавиатурной матрицы и не зависит напрямую от обозначений, нанесенных на поверхность 
  клавиш. Этот номер называется <b><a href="../practicum/table_cod.htm" target=_blanc>скан-кодом 
  </a></b>(Scan Code). Слово scan (&quot;сканирование&quot;) подчеркивает тот 
  факт, что клавиатурный компьютер сканирует клавиатуру для поиска нажатой клавиши. 
</p>
<p>Но программе нужен не порядковый номер нажатой клавиши, а соответствующий обозначению 
  на этой клавише <b><a href="../practicum/table_cod.htm"target=_blanc>ASCII-код.</a></b> Этот 
  код не зависит однозначно от скан-кода, т.к. одной и той же клавише могут соответствовать 
  несколько значений ASCII-кода. Это зависит от состояния других клавиш. Например, 
  клавиша с обозначением '1' используется еще и для ввода символа '!' (если она 
  нажата вместе с клавишей SHIFT). Поэтому все преобразования скан-кода в ASCII-код 
  выполняются программным обеспечением. Как правило, эти преобразования выполняют 
  модули BIOS. Для использования символов кириллицы эти модули расширяются клавиатурными 
  драйверами.</p>
<p>Если нажать на клавишу и не отпускать ее, клавиатура перейдет в режим автоповтора. 
  В этом режиме в центральный компьютер автоматически через некоторый период времени, 
  называемый периодом автоповтора, посылается код нажатой клавиши. Режим автоповтора 
  облегчает ввод с клавиатуры большого количества одинаковых символов. Фактически 
  все современные персональные компьютеры позволяют настроить как скорость автоповтора, 
  так и период удержания клавиши до начала включения этого режима.</p>
<p>Следует отметить, что клавиатура содержит внутренний 16-байтовый буфер, через 
  который она осуществляет обмен данными с компьютером. </p>
<p> В настоящее время существует три различных типа клавиатуры. Это клавиатура 
  для компьютеров IBM PC/XT, 84-клавишная клавиатура для IBM AT и 101-клавишная 
  (расширенная) клавиатура для IBM AT. Используется только последняя разновидность. 
  С выходом т.н. операционной системы Windows95® на клавиатурах появились две 
  новые клавиши, которые удобно использовать для работы в этой среде. Также наметилась 
  тенденция добавлять еще одну клавишу неопределенного назначения (чаще всего 
  эта клавиша позволяет устанавливать скорость автоповтора). Таким образом, можно 
  сказать, что современная клавиатура настольного ПК имеет 104 или 105 клавиш; 
  переносные ПК (Notebook то есть) имеют меньше клавиш.</p>
<h3 CLASS="Y" align="center"><b>ПОРТЫ КЛАВИАТУРЫ</b></h3>
<p>Для работы с клавиатурой используют порты 60h и 61h. Порт 60h используется 
  для чтения скэн-кода последней нажатой или отпущенной клавиши. </p>
<p>Порт 61h управляет не только клавиатурой, но и другими устройствами компьютера, 
  например, работой встроенного динамика. Этот порт доступен как для чтения, так 
  и для записи. Для нас важен самый старший бит этого порта. Если в старший бит 
  порта 61h записать значение 1, клавиатура будет заблокирована, если 0 - разблокирована. 
</p>
<p>Так как порт 61h управляет не только клавиатурой, при изменении содержимого 
  старшего бита необходимо сохранить состояние остальных битов этого порта. Для 
  этого можно сначала выполнить чтение содержимого порта в регистр, изменить состояние 
  старшего бита, затем выполнить запись нового значения в порт.</p>
<p>Естьвозможность управлять скоростными характеристиками клавиатуры, а также 
  зажигать или гасить светодиоды на лицевой панели клавиатуры - Scroll Lock, Num 
  Lock, Caps Lock. Для расширенного управления клавиатурой используется порт 60h 
  в режиме записи. Этот порт используются для управления подчиненным процессором 
  Intel 8042 (или схем, выполняющих такую же функцию), ответственным за обмен 
  данными с клавиатурным компьютером. </p>
<p>Процессор 8042 обслуживает не только клавиатуру, но и другие системы компьютера. 
  Через порт 64h, например, выполняется сброс (отключение) процессора 80286 для 
  возврата из защищенного режима работы в реальный. </p>
<p>Для посылки команды процессору 8042 вначале необходимо убедиться в том, что 
  его внутренняя очередь команд пуста. Это можно сделать, прочитав слово состояния 
  8042 из порта с адресом 64h. Бит с номером 1 должен быть равен нулю. После того, 
  как программа дождется готовности процессора 8042, она может послать ему команду, 
  записав ее в порт с адресом 60h. Некоторые команды состоят более чем из одного 
  байта. Остальные байты команды необходимо записать в порт 60h, предварительно 
  убедившись в готовности процессора 8042. В большинстве случаев можно также использовать 
  простую временную задержку. </p>
<h3 align="center"><b>ПРЕРЫВАНИЯ КЛАВИАТУРЫ</b></h3>
<p>Клавиатура подключена к линии прерывания IRQ1. Этой линии обычно соответствует 
  прерывание INT&nbsp;09h.</p>
<p>Клавиатурное прерывание обслуживается модулями BIOS. Драйверы клавиатуры и 
  резидентные программы могут организовывать дополнительную обработку прерывания 
  INT&nbsp;09h. </p>
<p>Стандартный обработчик клавиатуры выполняет следующие действия: </p>
<p>• читает из порта 60h скан-код нажатой клавиши; </p>
<p>• записывает вычисленное по скан-коду значение ASCII-кода нажатой клавиши в 
  специальный буфер клавиатуры, расположенный в области данных BIOS;</p>
<p>• устанавливает в 1 бит 7 порта 61h, разрешая дальнейшую работу клавиатуры;</p>
<p>• возвращает этот бит в исходное состояние; </p>
<p>• записывает в порт 20h значение 20h для правильного завершения обработки аппаратного 
  прерывания. </p>
<p>Обработчик прерывания INT&nbsp;09h не просто записывает значение ASCII-кода 
  в буфер клавиатуры. Дополнительно отслеживаются нажатия таких комбинаций клавиш, 
  как Ctrl-Alt-Del, обрабатываются специальные клавиши PrtSc и SysReq. При вычислении 
  кода ASCII нажатой клавиши учитывается состояние клавиш Shift и CapsLock. </p>
<p>Буфер клавиатуры имеет длину 32 байта и расположен по адресу 0000h:041Eh для 
  машин IBM PC/XT. В IBM AT и PS/2 расположение клавиатурного буфера задается 
  содержимым двух слов памяти с адресами 0000h:0480h (компонента смещения адреса 
  начала буфера) и 0000h:0482h (смещение конца буфера). Обычно в IBM AT эти ячейки 
  памяти содержат значения, соответственно, 001Eh и 003Eh. Так как смещения заданы 
  относительно сегментного адреса 0040h, то видно, что обычное расположение клавиатурного 
  буфера в IBM AT и PS/2 соответствует его расположению в IBM PC/XT. </p>
<p>Клавиатурный буфер организован циклически. Это означает, что при его переполнении 
  самые старые значения будут потеряны. Две ячейки памяти, находящиеся в области 
  данных BIOS с адресами 0000h:041Ah и 0000h:041Ch содержат, соответственно, указатели 
  на начало и конец буфера. Если значения этих указателей равны друг другу, буфер 
  пуст. (Можно удалить все символы из буфера клавиатуры, установив оба указателя 
  на начало буфера. Однако есть более предпочтительный способ с использованием 
  прерывания BIOS INT&nbsp;16h). Указателями на начало и конец клавиатурного буфера 
  обычно управляют обработчики прерываний INT&nbsp;09h и INT&nbsp;16h. Программа 
  извлекает из буфера коды нажатых клавиш, используя различные функции прерывания 
  INT&nbsp;16h. </p>
<p>Помимо управления содержимым буфера клавиатуры, обработчик прерывания INT&nbsp;09h 
  отслеживает нажатия на так называемые переключающие клавиши - NumLock, ScrollLock, 
  CapsLock, Ins. Состояние этих клавиш записывается в область данных BIOS в два 
  байта с адресами 0000h:0417h и 0000h:0418h. </p>
<p>Программой обработки прерывания INT&nbsp;09h отслеживаются некоторые комбинации 
  клавиш, такие, как Ctrl-Alt-Del или Ctrl-Break. </p>
<p>Современные клавиатуры имеют отдельную альтернативную цифровую панель, напоминающую 
  клавиатуру калькулятора. Если одновременно с нажатием на клавишу Alt набрать 
  число на этой панели (не большее, чем 255 и не равное 0), то это число будет 
  помещено в буфер клавиатуры, как будто бы оно было введено нажатием на одну 
  клавишу. Это число будет также записано в слове по адресу 0000h:0419h в области 
  данных BIOS. </p>
<p>При переполнении внутреннего буфера клавиатуры или буфера, расположенного в 
  области данных BIOS, программа-обработчик прерывания INT&nbsp;09h генерирует 
  звуковой сигнал.</p>
<p>Изучить проблемы управления дисковой памятью на логическом уровне можно по 
  <a href="../library/frolov/278-7.html" target=_blank>книге [6].</a> </p>
<hr class=forhr align="center">
<div align="center"> 
  <table width="600">
    <tr> 
      <td> 
        <p align="center">&nbsp;</p>
      </td>
      <td> 
        <p align="center"><b> <a href="perif.htm"target="mainFrame">в начало раздела</a></b></p>
      </td>
      <td> 
        <p align="center">&nbsp;</p>
      </td>
    </tr>
  </table>
</div>
<h1>&nbsp;</h1  >
<p><strong></strong> <strong><font color="#0000FF"></font></strong></p>
<p>&nbsp;</p> 
</body>
</html>
