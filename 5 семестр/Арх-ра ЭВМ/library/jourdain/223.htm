<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 2. Таймеры и звук.</p> <p class="hdr2">Раздел 2. Создание звука.</p> <p class="hdr3">2.2.3 Генерация звука одновременно с другими действиями.</p> <p> Для программистов на Бейсике различие между этим и предыдущим разделом совершенно несущественно. Hо программисты на ассемблере должны использовать совершенно другой метод. Поскольку микросхема таймера 8253 работает независимо от процессора, то очень просто генерировать звук, который издается одновременно с выполнением других операций. Вы должны просто запрограммировать канал 2 этой микросхемы для генерации определенной частоты, а затем перепрограммировать микросхему для выключения звука. <p> Hизкий уровень. <p> Просто пошлите счетчик в канал 2, как объяснено в {<a href="211.htm">2.1.1</a>}. Микросхема должна быть предварительно разрешена через порт B микросхемы интерфейса с периферией 8255 (адрес 61H). Вычислите требуемое значение счетчика для задвижки, разделив 1.19 миллионов на требуемую частоту в герцах. Звук будет продолжаться до тех пор, пока не будут закрыты ворота канала 2. Поэтому Вы должны сбросить бит 1 порта B в 0, иначе звук будет продолжаться бесконечно и может быть прекращен только перезагрузкой компьютера. Для точного регулирования длительности звука можно использовать счетчик времени суток BIOS, как указано в {<a href="216.htm">2.1.6</a>}. В данном примере генерируется частота 440 герц. Звук прекращается после нажатия любой клавиши на клавиатуре. <table align="center"> <tr><td></td><td>;---рарешение канала 2 установкой порта B микросхемы 8255</td></tr> <tr><td>PORT_B EQU 61H </td><td>;установка адреса порта B</td></tr> <tr><td>IN AL,PORT_B </td><td>;чтение его значения</td></tr> <tr><td>OR AL,3 </td><td>;установка двух младших битов</td></tr> <tr><td>OUT PORT_B,AL </td><td>;посылаем байт в порт B</td></tr> <tr><td></td><td>;---установка регистров ввода/вывода</td></tr> <tr><td>COMMAND_REG EQU 43H </td><td>;адрес командного регистра</td></tr> <tr><td>CHANNEL_2 EQU 42H </td><td>;адрес канала 2</td></tr> <tr><td>MOV AL,10110110B </td><td>;цепочка битов для канала 2</td></tr> <tr><td>OUT COMMAND_REG,AL </td><td>;засылка в командный регистр</td></tr> <tr><td></td><td>;---засылка счетчика в задвижку</td></tr> <tr><td>MOV AX,2705 </td><td>;счетчик = 1190000/440</td></tr> <tr><td>OUT CHANNEL_2,AL </td><td>;посылаем младший байт </td></tr> <tr><td>MOV AL,AH </td><td>;сдвигаем младший байт в AL</td></tr> <tr><td>OUT CHANNEL_2,AL </td><td>;посылаем старший байт</td></tr> <tr><td></td><td>;---ждем нажатия клавиши</td></tr> <tr><td>MOV AH,1 </td><td>;номер функции прерывания 21H</td></tr> <tr><td>INT 21H </td><td>;вызываем прерывание</td></tr> <tr><td></td><td>;---выключение звука</td></tr> <tr><td>IN AL,PORT_B </td><td>;получаем байт из порта B</td></tr> <tr><td>AND AL,11111100B </td><td>;сбрасываем два младших бита</td></tr> <tr><td>OUT PORT_B,AL </td><td>;посылаем байт обратно</td></tr> </table> <hr><p align="center">
<~-<a href="222.htm">2.2.2 Генерация тона.</a><br><a href="index.htm#header">Содержание</a><br><a href="224.htm">2.2.4 Гудок динамика.</a>-~>
</p></body></html>
