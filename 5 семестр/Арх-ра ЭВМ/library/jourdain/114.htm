<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 1. Системные ресурсы.</p> <p class="hdr2">Раздел 1. Ревизия системных ресурсов.</p> <p class="hdr3">1.1.4 Определение числа и типов адаптеров дисплея.</p> <p> Программе может оказаться необходима информация о том, будет ли она работать в системе с монохромным адаптером, с цветной графической картой или с EGA, а также о наличии второго адаптера. В пункте {<a href="416.htm">4.1.6</a>} объяснено как передать управление от одного адаптера к другому. Байт статуса оборудования, хранящийся в области данных ROM-BIOS по адресу 0040:0010 сообщает установку переключателя 1, который показывает какая из карт активна. В принципе должны иметь значение 11 для монохромной карты, 10 - для цветной карты 80*25, 01 - для цветной карты 40*25 и 00 для EGA. Однако при наличии EGA он может установить биты отличными от 00, в зависимости от установки его собственных переключателей. Поэтому Вы должны сначала другими средствами установить наличие EGA, а затем, если его нет, то по данным BIOS определить является ли активным цветной или монохромный адаптер. Для проверки наличия EGA надо прочитать байт по адресу 0040:0087. Если он равен 0, то EGA отсутствует. Если этот байт ненулевой, то когда бит 3=0, EGA является активным адаптером, а когда он равен 1, то активен второй адаптер. <p> Kогда присутствует EGA, то проверка наличия монохромного или цветного адаптера осуществляется записью значения в регистр адреса курсора микросхемы 6845 {<a href="411.htm">4.1.1</a>} и последующего чтения значения и проверки их на совпадение. Для монохромной карты пошлите 0FH в порт 3B4H, чтобы указать на регистр курсора, а затем прочитать и записать адрес курсора через порт 3B5H. Соответствующие порты для цветной карты 3D4H и 3D5H. Kогда карта отсутствует, то порт возвращает значение 0FFH; но поскольку это значение может содержаться в регистре, то недостаточно простой проверки на это значение. <p> Имеются два добавочных вопроса, на которые могут потребоваться ответы при наличии EGA: сколько имеется памяти на его карте и какой тип монитора подсоединен? Для определения типа дисплея проверьте бит 1 по адресу 0040:0087; когда он установлен, то подсоединен ммонохромный дисплей, а когда он равен нулю - цветной. Если Ваша программа использует цветной графический режим с 350 строками, то надо также определить присоединен ли дисплей IRGB или R'G'B'RGB, где последняя аббревиатура соответствует улучшеному цветному дисплею IBM. Это определяется установкой четырех переключателей на карте EGA. Установка этих переключателей возвращается в CL при обращении к функции 12H прерывания 10H. Цепочка четырех младших битов должна быть 0110 для улучшенного цветного дисплея. Та же самая функция сообщает и наличие памяти на карте EGA. Она возвращает BL, содержащий 0 для 64K, 1 - для 128, 2 - для 192 и 3 - для полных 256K памяти дисплея. <p> Hизкий уровень. <table align="center"> <tr><td></td><td>;--- Определение активного адаптера:</td></tr> <tr><td>MOV AX,40H </td><td>;указываем ES на область данных BIOS</td></tr> <tr><td>MOV ES,AX </td><td>;</td></tr> <tr><td>MOV AL,ES:[87H] </td><td>;проверяем наличие EGA</td></tr> <tr><td>CMP AL,0 </td><td>;</td></tr> <tr><td>JE NO_EGA </td><td>;если 0040:0087 = 0, то EGA нет</td></tr> <tr><td>TEST AL,00001000B </td><td>;EGA есть, проверяем бит 3</td></tr> <tr><td>JNZ EGA_NOT_ACTIVE</td><td>;если бит 3=1, то EGA неактивен</td></tr> <tr><td>.</td><td></td></tr> <tr><td>.</td><td></td></tr> <tr><td>EGA_NOT_ACTIVE:</td><td></td></tr> <tr><td>MOV AL,ES:[10H] </td><td>;проверяем байт статуса дисплея</td></tr> <tr><td>AND AL,00110000B </td><td>;выделяем биты 4 и 5</td></tr> <tr><td>CMP AL,48 </td><td>;это монохромная карта?</td></tr> <tr><td>JE MONOCHROME </td><td>;переход если да</td></tr> </table> <p> Предполагая наличие монохромной карты проверим установлена ли цветная карта (неактивная): <table align="center"> <tr><td></td><td>;--- Установлена ли неактивная цветная карта?</td></tr> <tr><td>MOV DX,3D4H </td><td>;указываем на регистр адреса 6845</td></tr> <tr><td>MOV AL,0FH </td><td>;запрашиваем регистр курсора</td></tr> <tr><td>OUT DX,AL </td><td>;указываем на регистр</td></tr> <tr><td>INC DX </td><td>;указываем на регистр данных</td></tr> <tr><td>IN AL,DX </td><td>;получаем текущее значение</td></tr> <tr><td>XCNG AH,AL </td><td>;сохраняем значение</td></tr> <tr><td>MOV AL,100 </td><td>;тестовое значение 100</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем его</td></tr> <tr><td>IN AL,DX </td><td>;считываем его снова</td></tr> <tr><td>CMP AL,100 </td><td>;сравниваем значения</td></tr> <tr><td>JNE NO_CARD </td><td>;переход если нет карты</td></tr> <tr><td>XCNG AH,AL </td><td>;иначе есть цветная карта</td></tr> <tr><td>OUT DX,AL </td><td>;тогда восстанавливаем значение</td></tr> </table> <hr><p align="center">
<~-<a href="113.htm">1.1.3 Определение версии MS DOS.</a><br><a href="index.htm#header">Содержание</a><br><a href="115.htm">1.1.5 Определение числа и типа дисковых накопителей.</a>-~>
</p></body></html>
