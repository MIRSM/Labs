<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 7. Ввод/вывод.</p> <p class="hdr2">Раздел 3. Использование специальных устройств ввода/вывода.</p> <p class="hdr3">7.3.2 Чтение позиции светового пера.</p> <p> Хотя очень немногие компьютеры оснащены световым пером, тем не менее это одно из немногих вспомогательных устройств, которое поддерживается как оборудованием, так и операционной системой. Световое перо работает с помощью небольшого оптического детектора на кончике пера. По ходу сканирования экрана электронным лучом инициируется импульс оптического детектора, когда пучок достигает точки экрана, над которой находится перо. Время возникновения этого импульса, относительно сигналов горизонтальной и вертикальной синхронизации, позволяет определить позицию светового пера. <p> Средний уровень. <p> Функция 4 прерывания 10H BIOS сообщает текущую позицию светового пера. У нее нет входных регистров. При возврате AX содержит 0, если перо не включено и 1 - если получены новые значения для его позиции. Возвращается два набора координат, позиции точки и позиции строки и столбца. Позиции символа содержатся в DX, причем DH содержит строку (0-24), а DL - столбец (0-79). Позиция точки содержится в CH и BX, причем CH содержит вертикальную координату (0-199), а BX - горизонтальную (0-319 или 0-639, в зависимости от режима терминала). <table align="center"> <tr><td></td><td>;---читаем и запоминаем положение светового пера</td></tr> <tr><td>MOV AH,4 </td><td>;номер функции</td></tr> <tr><td>INT 10H </td><td>;прерывание BIOS</td></tr> <tr><td>CMP AH,1 </td><td>;новая позиция?</td></tr> <tr><td>JE NO_READING </td><td>;если нет, то уходим</td></tr> <tr><td>MOV COL,BX </td><td>;сохраняем горизонтальную координату</td></tr> <tr><td>MOV CL,CH </td><td>;помещаем вертикальную координату</td></tr> <tr><td>MOV CH,0 </td><td>;в CX</td></tr> <tr><td>MOV ROW,CX </td><td>;сохраняем вертикальную координату</td></tr> </table> <p> Hизкий уровень. <p> По своей сути световое перо является расширением видеосистемы и как таковое использует микросхему контроллера CRT 6845. Позиция светового пера дается одним 2-хбайтным значением, хранящимся в регистрах 10H (старший байт) и 11H (младший байт) микросхемы. В {<a href="411.htm">4.1.1</a>} объясняется как читать регистры микросхемы. Посмотрите пример. Порт с адресом 3DCH устанавливает задвижку светового пера, а с номером 3DBH - сбрасывает ее. <table align="center"> <tr><td></td><td>;---проверка светового пера и чтение его позиции</td></tr> <tr><td>MOV DX,3DAH </td><td>;указываем на регистр статуса</td></tr> <tr><td>IN AL,DX </td><td>;получаем информацию</td></tr> <tr><td>TEST AL,4 </td><td>;проверяем выключатель</td></tr> <tr><td>JNZ NOT_SET </td><td>;на выход</td></tr> <tr><td>TEST AL,2 </td><td>;проверяем триггер</td></tr> <tr><td>JZ NOT_SET </td><td>;на выход</td></tr> <tr><td>SUB DX,7 </td><td>;указываем на регистр адреса 6845</td></tr> <tr><td>MOV AL,10H </td><td>;запрос на старший байт позиции пера</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем запрос</td></tr> <tr><td>INC DX </td><td>;указываем на регистр данных 6845</td></tr> <tr><td>IN AL,DX </td><td>;получаем значение</td></tr> <tr><td>XCNG AH,AL </td><td>;запоминаем его в AH</td></tr> <tr><td>DEC DX </td><td>;возвращаемся к адресному регистру</td></tr> <tr><td>MOV AL,11H </td><td>;теперь хотим получить младший байт</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем запрос</td></tr> <tr><td>INC DX </td><td>;назад к регистру данных</td></tr> <tr><td>IN AL,DX </td><td>;теперь это значение в AX</td></tr> </table> <hr><p align="center">
<~-<a href="731.htm">7.3.1 Чтение/запись с кассетного магнитофона.</a><br><a href="index.htm#header">Содержание</a><br><a href="733.htm">7.3.3 Получение аналогового ввода через игровой порт.</a>-~>
</p></body></html>
