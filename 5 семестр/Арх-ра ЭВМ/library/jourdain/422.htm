<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 4. Вывод на терминал.</p> <p class="hdr2">Раздел 2. Управление курсором.</p> <p class="hdr3">4.2.2 Относительное позиционирование курсора</p> <p> Иногда бывает полезным сдвинуть курсор относительно его предыдущей позиции: на строку вверх, на три столбца вправо, и т.д. Достаточно просто использовать для этой цели уже описанное абсолютное позиционирование курсора. Hо для удобства MS DOS предоставляет некоторые возможности относительного перемещения курсора. <p> Средний уровень. <p> Функции относительного перемещения курсора выполняются Esc-последовательностями. Это строки, которые выводятся на экран с помощью функции 9 прерывания 21H. В приложении Д даны основы их использования. Такие последовательности интерпретируются MS DOS как команды перемещения курсора, а не вывод символов строки. Строка начинается с символа Esc (ASCII 27), затем идет символ [, а символ $ отмечает конец строки. Сама строка состоит из числа позиций, на которое надо сдвинуться, и кода направления. Чтобы сдвинуться на 3 позиции: <pre class="asm"> 
         вверх           3A 
         вниз            3B 
         вправо          3C 
         влево           3D 
</pre> 
Числа записываются как коды ASCII. Hе преобразуйте, например, 33C (33 пробела вправо) в 33,'C'; должно быть '33C'. В нижеприведенном примере цифры 1-8 помещаются через определенные интервалы поперек экрана, как метки столбцов данных. Промежутки между цифрами генерируются Esc-последовательностями, которые сдвигают  курсор вправо после вывода каждой цифры. <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>CURSOR_RIGHT DB 27,'[9C$'</td><td></td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---установка начальной позиции курсора</td></tr> <tr><td>MOV BH,0 </td><td>;ноиер страницы</td></tr> <tr><td>MOV DH,1 </td><td>;строка</td></tr> <tr><td>MOV DL,5 </td><td>;столбец</td></tr> <tr><td>MOV AH,2 </td><td>;функция установки курсора</td></tr> <tr><td>INT 10H </td><td>;установка курсора</td></tr> <tr><td></td><td>;---вывод цифр</td></tr> <tr><td>LEA BX,CURSOR_RIGHT </td><td>;BX будет обмениваться с DX</td></tr> <tr><td>MOV CX,8 </td><td>;число цифр для вывода</td></tr> <tr><td>MOV DL,'0' </td><td>;начинаем с 0</td></tr> <tr><td>NEXT_NUMBER: MOV AH,2 </td><td>;функция DOS для вывода символа</td></tr> <tr><td>INT 21H </td><td>;выводим символ</td></tr> <tr><td>INC DL </td><td>;переходим к следующему коду ASCII</td></tr> <tr><td>XCHG DX,BX </td><td>;помещаем указатель на строку в DX</td></tr> <tr><td>MOV AH,9 </td><td>;функция вывода строки</td></tr> <tr><td>INT 21H </td><td>;сдвигаем курсор на 9 позиций вправо</td></tr> <tr><td>XCHG DX,BX </td><td>;возвращаем в DX код ASCII</td></tr> <tr><td>LOOP NEXT_NUMBER </td><td>;переходим к следующей цифре</td></tr> </table> <p> Имеется также пара Esc-последовательностей, которые управляют переносом курсора на следующую строку при достижении им конца текущей строки. Kогда устанавливается отсутствие переноса, то лишние символы при выводе отбрасываются. Строка, запрещающая перенос - Esc [=7h (или как данные, 27,'[=7h'). Для возврата к режиму автоматического переноса на следующую строку используется строка Esc [=7l (27,'[=7l'). <hr><p align="center">
<~-<a href="421.htm">4.2.1 Установка курсора в абсолютную позицию.</a><br><a href="index.htm#header">Содержание</a><br><a href="423.htm">4.2.3 Включение и выключение курсора.</a>-~>
</p></body></html>
