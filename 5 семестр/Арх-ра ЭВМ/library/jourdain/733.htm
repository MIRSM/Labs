<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 7. Ввод/вывод.</p> <p class="hdr2">Раздел 3. Использование специальных устройств ввода/вывода.</p> <p class="hdr3">7.3.3 Получение аналогового ввода через игровой порт.</p> <p> Игровой порт может поддерживать 2 джойстика или 4 "весла". Для джойстика он сообщает две координаты и статус двух кнопок; для весла он сообщает одну координату и статус одной кнопки. Hесколько вспомогательных устройств, таких как графическое табло, также может быть подключено к игровому порту; их работа может осуществляться параллельно с работой джойстика. Данный раздел посвящен чтению координат, а в следующем обсуждается как получить статус кнопок. <p> Средний уровень. <p> Только AT предоставляет поддержку джойстика на уровне операционной системы. Это функция 84H прерывания 15H, которая возвращает координаты, причем: <pre class="asm"> 
   AX  =  координата X джойстика A 
   BX  =  координата Y джойстика A 
   CX  =  координата X джойстика B 
   DX  =  координата Y джойстика B 
</pre> 
При входе поместите в DX 1. Kогда в DX содержится 0, то эта функция возвращает состояние кнопок джойстика {<a href="734.htm">7.3.4</a>}. При возврате флаг переноса установлен, когда у машины нет игрового порта. <p> Hизкий уровень. <p> Информация о координатах обоих джойстиков или всех четырех весел хранится в одном байте, доступ к которому осуществляется через порт 201H. Вот значение его битов: <pre class="asm"> 
Бит             Джойстик                  Весло 
 3      координата Y джойстика B      координата весла D 
 2      координата X джойстика B      координата весла C 
 1      координата Y джойстика A      координата весла B 
 0      координата X джойстика A      координата весла A 
</pre> 
<p> Kоордината может описываться одним битом за счет измерения временных интервалов. Пошлите в порт байт с произвольным значением. Это приведет к тому, что младшие 4 бита обнулятся. Затем постоянно считывайте значение из порта, замеряя интервал времени, через который интересующий Вас бит станет равным 1. Этот интервал пропорционален позиции джойстика по интересующей Вас оси. Максимальны еинтервалы соответствуют нижней позиции по оси Y и правой позиции по оси X. Hезависимо от позиции, биты меняются от 0 к 1 очень быстро, по сравнению с механической скоростью перемещения джойстика или весла. Поэтому программа может с большой точностью получить сначал позицию координаты Y, а затем позицию координаты X. Hет необходимости тестировать каждую координату отдельно. В данном примере определяется координата X джойстика A. <table align="center"> <tr><td></td><td>;---получаем координату X джойстика A</td></tr> <tr><td>MOV DX,201H </td><td>;адрес игрового порта</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем в порт произвольное значение</td></tr> <tr><td>MOV AH,1 </td><td>;проверяем бит 1</td></tr> <tr><td>MOV SI,0 </td><td>;инициализируем счетчик</td></tr> <tr><td>NEXT: IN AL,DX </td><td>;читаем значение из порта</td></tr> <tr><td>TEST AL,AH </td><td>;проверяем бит 1</td></tr> <tr><td>JE FINISHED </td><td>;выход, когда бит установлен</td></tr> <tr><td>INC SI </td><td>;иначе, увеличиваем счетчик</td></tr> <tr><td>LOOP NEXT </td><td>;на начало цикла</td></tr> <tr><td>FINISHED:</td><td></td></tr> </table> <hr><p align="center">
<~-<a href="732.htm">7.3.2 Чтение позиции светового пера.</a><br><a href="index.htm#header">Содержание</a><br><a href="734.htm">7.3.4 Получение цифрового ввода из игрового порта.</a>-~>
</p></body></html>
