<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 2. Таймеры и звук.</p> <p class="hdr2">Раздел 1. Установка и чтение таймера.</p> <p class="hdr3">2.1.3 Установка/чтение даты.</p> <p> При включении компьютера MS DOS запрашивает у пользователя текущие дату и время. Время записывается в области данных BIOS. Дата же содержится в переменной в COMMAND.COM. Она хранится в формате трех последовательных байтов, которые содержат соответственно день месяца, номер месяца и номер года, начиная с 0, где 0 соответствует 1980 году. В отличии от счетчика времени суток, адрес даты в памяти меняется с изменением версии DOS и положением в памяти COMMAND.COM. По этой причине для получения даты всегда надо использовать готовые утилиты Бейсика или MS DOS, а не обращаться к этой переменной напрямую. <p> Машины, оборудованные микросхемой календаря-часов, автоматически устанавливают время и дату с помощью специальной программы (обычно запускаемой при старте через файл AUTOEXEC.BAT). Kак получить доступ к микросхеме календаря-часов, см. {<a href="214.htm">2.1.4</a>}. Отметим также, что когда счетчик времени суток BIOS переходит через отметку 24 часов, MS DOS меняет дату. <p> Средний уровень. <p> Функции 2AH и 2BH прерывания 21H получают и устанавливают дату. Для получения даты поместите в AH 2AH и выполните прерывание. При возврате CX будет содержать год в виде числа от 0 до 119, что соответствует диапазону лет 1980 - 2099 (можно сказать что выдается смещение относительно 1980 г.). DH содержит номер месяца, а DL - день. <table align="center"> <tr><td>MOV AH,2AH </td><td>;номер функции получения даты</td></tr> <tr><td>INT 21H </td><td>;получение даты</td></tr> <tr><td>MOV DAY,DL </td><td>;день из DL</td></tr> <tr><td>MOV MONTH,DH </td><td>;месяц из DH</td></tr> <tr><td>ADD CX,1980 </td><td>;добавляем базу к году</td></tr> <tr><td>MOV YEAR,CX </td><td>;получаем номер года</td></tr> </table> <p> Для установки даты поместите день, месяц и год в те же регистры и выполните функцию 2BH. Если значения, указанные для даты неверны, то в AL будет возвращено FF, в противном случае - 0. <table align="center"> <tr><td>MOV DL,DAY </td><td>;помещаем день в DL</td></tr> <tr><td>MOV DH,MONTH </td><td>;помещаем месяц в DH</td></tr> <tr><td>MOV CX,YEAR </td><td>;помещаем год в CX</td></tr> <tr><td>SUB CX,1980 </td><td>;берем смещение относительно 1980</td></tr> <tr><td>MOV AH,2BH </td><td>;номер функции установки даты</td></tr> <tr><td>INT 21H </td><td>;установка даты</td></tr> <tr><td>CMP AH,0FFH </td><td>;проверяем успешность операции</td></tr> <tr><td>JE ERROR </td><td>;неверная дата, идем на обработку ошибки</td></tr> </table> <hr><p align="center">
<~-<a href="212.htm">2.1.2 Установка/чтение времени.</a><br><a href="index.htm#header">Содержание</a><br><a href="214.htm">2.1.4 Установка/чтение часов реального времени.</a>-~>
</p></body></html>
