<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 5. Дисковые накопители.</p> <p class="hdr2">Раздел 2. Работа с каталогами диска.</p> <p class="hdr3">5.2.4 Получение/установка текущего каталога.</p> <p> Текущий каталог это каталог, в котором DOS ищет файл, для которого не указан путь. Если не установлено противного, то текущий каталог является корневым каталогом. <p> Средний уровень. <p> Функция 3BH прерывания 21H устанавливает текущий каталог. DS:DX должны указывать на путь к каталогу в стандартном виде и эта строка должна завершаться байтом ASCII 0. Hапример, B:BIRDS\PARROTS\POLLY делает POLLY текущим каталогом. B: может быть опущено, если это текущий накопитель по умолчанию {<a href="531.htm">5.3.1</a>}. Чтобы сделать текущим корневой каталог накопителя A: напишите A:\. В примере текущим каталогом устанавливается POLLY: <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>PATH DB 'B:BIRDS\PARROTS\POLLY',0</td><td></td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---делаем POLLY текущим каталогом</td></tr> <tr><td>MOV AH,3BH </td><td>;номер функции</td></tr> <tr><td>LEA DX,PATH </td><td>;DS:DX должны указывать на путь</td></tr> <tr><td>INT 21H </td><td>;устанавливаем текущий каталог</td></tr> </table> <p> Чтобы определить какой каталог является текущим надо использовать функцию 47H прерывания 21H. DS:SI должны указывать на область данных размером 64 байта, в которую будет записан путь. В DL указывается накопитель, причем 0 = "по умолчанию", 1 = A, 2 = B и т.д. При возврате функция возвращает строку без имени накопителя. Если был указан несуществующий накопитель, то в AL возвращается код ошибки 15. Строка начинается с имени первого подкаталога цепочки, а не с обратной косой черты. Байт ASCII 0 сигнализирует о конце строки. В данном примере имя текущего каталога присваивается переменной "CURRENT_DIR": <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>CURRENT_DIR DB 64 DUP(?)</td><td></td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---получить текущий каталог</td></tr> <tr><td>MOV AH,47H </td><td>;номер функции</td></tr> <tr><td>LEA SI,CURRENT_DIR </td><td>;указываем на область данных</td></tr> <tr><td>MOV DL,1 </td><td>;накопитель A</td></tr> <tr><td>INT 21H </td><td>;помещает строку по адресу DS:SI</td></tr> </table> <hr><p align="center">
<~-<a href="523.htm">5.2.3 Чтение/изменение подкаталога.</a><br><a href="index.htm#header">Содержание</a><br><a href="525.htm">5.2.5 Получение/установка времени и даты последнего доступа к файлу.</a>-~>
</p></body></html>
