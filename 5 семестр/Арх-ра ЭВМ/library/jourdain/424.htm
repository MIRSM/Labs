<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 4. Вывод на терминал.</p> <p class="hdr2">Раздел 2. Управление курсором.</p> <p class="hdr3">4.2.4 Изменение формы курсора.</p> <p> Kурсор может меняться по толщине от тонкой линии до максимального размера, отводимого под символ. Он строится из коротких горизонтальных отрезков, верхний из которых называется "начальной строкой" курсора, а нижний - "конечной строкой". Для монохромного дисплея под каждый символ отводится 14 строк, пронумерованных от 0 до 13, начиная сверху. Промежутки между символами обеспечиваются двумя верхними строками и тремя нижними. Большинство символов распологаются в строках 2-10, хотя хвостики некоторых символов достигают линий 12 и 13, в то время как подчеркивание занимает одну двенадцатую строку. <p> Hа 200-строчном цветном дисплее для каждого символа отводится только 8 строк, а символ рисуется в верхних семи строках. Эти 8 строк пронумерованы от 0 до 7, начиная сверху, и нормальный курсор формируется одной строкой 7. (Отметим, что на цветном дисплее нет подчеркивания, поскольку использование для подчеркивания строки 7 привело бы к тому, что символы сливались бы с расположенными под ними.) Цветной дисплей высокого разрешения использует 14-строчный монохромный вариант, когда он работает в режиме высокого разрешения, а когда он работает в одном из цветных графических режимов, то он использует 8-строчный режим. <p> Kурсор может быть сформирован любой комбинацией прилегающих отрезков. Для монохромного дисплея он занимает все отведенное под символ место, когда "начальная строка" равна 0, а "конечная строка" равна 13 (для графического дисплея надо использовать значение "конечной строки" равное 7). Если значения "начальной" и "конечной" строки совпадают, то возникает однострочный курсор. Если номер "конечной строки" меньше чем "начальной" то возникает курсор, состоящий из двух частей, так как происходит перенос в верхние строки. Hапример, если "начальная строка" равна 12, а "конечная" - 1, то сначала заполняется строка 12, затем 13, затем 0 и, наконец, 1. Kурсор при этом принимает форму двух параллельных линий, указывающих верхнюю и нижнюю границы ряда, который он занимает. <p> BIOS хранит 2-байтную переменную по адресу 0040:0060, которая содержит текущие значения "начальной" и "конечной" строк. Первый байт содержит значение "конечной строки", а второй - "начальной". <p> Средний уровень. <p> Функция 1 прерывания BIOS 10H устанавливает "начальную" и "конечную" строки курсора. В CH должна быть указана "начальная", а в CL - "конечная" строка. <table align="center"> <tr><td></td><td>;---установка "начальной" и "конечной" строк курсора</td></tr> <tr><td>MOV AH,1 </td><td>;номер функции</td></tr> <tr><td>MOV CH,0 </td><td>;начать курсор в верхней строке</td></tr> <tr><td>MOV CL,7 </td><td>;окончить курсор в восьмой строке</td></tr> <tr><td>INT 10H </td><td>;</td></tr> </table> <p> Hизкий уровень. <p> Регистры 10 и 11 контроллера дисплея 6845 содержат значения "начальной" и "конечной" строки, соответственно. Доступ к обоим регистрам осуществляется через порт 3B5H для монохромного адаптора и 3D5H - для цветного алаптора и PCjr. Предварительно надо послать номер требуемого регистра в адресный регистр, имеющий адрес порта 3B4H (см. {<a href="411.htm">4.1.1</a>}). Значения занимают младший конец каждого регистра. Однако регистр "начальной" строки (#10) битами 5 и 6 индицирует также должен ли выводиться курсор. Поскольку курсор выводится, когда оба этих бита сброшены в 0, то просто поместив в регистр номер "начальной" строки мы установим эти биты в 0. Остальные биты этого регистра не используются. <table align="center"> <tr><td></td><td>;---установка "начальной" строки</td></tr> <tr><td>MOV DX,3B4H </td><td>;доступ к адресному регистру 6845</td></tr> <tr><td>MOV AL,10 </td><td>;выбор регистра 6845</td></tr> <tr><td>OUT DX,AL </td><td>;посылка запроса</td></tr> <tr><td>MOV AL,0 </td><td>;номер "начальной строки" 0</td></tr> <tr><td>INC DX </td><td>;переходим к управляющему регистру</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем номер "начальной строки"</td></tr> <tr><td></td><td>;---установка "конечной строки"</td></tr> <tr><td>MOV AL,11 </td><td>;выбираем регистр 11</td></tr> <tr><td>DEC DX </td><td>;возвращаемся к адресному регистру</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем запрос</td></tr> <tr><td>MOV AL,7 </td><td>;номер "конечной строки" 7</td></tr> <tr><td>INC DX </td><td>;переходим к управляющему регистру</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем номер "конечной строки"</td></tr> </table> <hr><p align="center">
<~-<a href="423.htm">4.2.3 Включение и выключение курсора.</a><br><a href="index.htm#header">Содержание</a><br><a href="425.htm">4.2.5 Чтение/сохранение/восстановление позиции курсора.</a>-~>
</p></body></html>
