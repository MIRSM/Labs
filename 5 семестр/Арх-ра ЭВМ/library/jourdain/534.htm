<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 5. Дисковые накопители.</p> <p class="hdr2">Раздел 3. Подготовка к работе с файлами.</p> <p class="hdr3">5.3.4 Переименование файла; изменение позиции файла в каталоге.</p> <p> Переименование файла может заключаться лишь в изменении первых 11-ти символов элемента каталога. Однако в древовидном каталоге весь элемент каталога может быть перенесен в другой подкаталог, переопределяя тем самым путь к файлу. Одна команда может как переименовать файл, так и перенести его в другой каталог. <p> Средний уровень. <p> MS DOS может переименовывать файлы, используя как метод управляющего блока файла, так и метод дескриптора файла. Первый из них может применяться только к файлам, расположенным в текущем каталоге. Метод FCB: <p> Используйте функцию 17H прерывания 21H. DS:DX должны указывать на открытый управляющий блок файла. Поместите новое имя файла в FCB, начиная со смещения 11H (это "резервная" область блока). Hовое имя может использовать символ "?", в этом случае символы, находящиеся в этих позициях, не будут изменяться. При возврате, если новое имя уже существовало в каталоге, то AL будет равно FF, иначе AL = 0. В примере имя файла ACCOUNTS.DAT меняется на DEBTS.DAT. <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>FCB DB 'FILENAMEEXT',25 DUP(0)</td><td></td></tr> <tr><td>NEWNAME DB 'NEWNAME EXT', </td><td>;11 символов нового имени</td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---помещаем новое имя файла в переменную NEWNAME</td></tr> <tr><td>MOV SI,OFFSET NEWNAME </td><td>;DS:SI указывают на новое имя </td></tr> <tr><td>MOV AX,SEG FCB </td><td>;ES:DI указывают на FCB</td></tr> <tr><td>MOV ES,AX </td><td>;</td></tr> <tr><td>MOV DI,OFFSET FCB </td><td>;</td></tr> <tr><td>ADD DI,11H </td><td>;начинаем со смещения 11H</td></tr> <tr><td>MOV CX,11 </td><td>;имя файла содержит 11 символов</td></tr> <tr><td>REP MOVSB </td><td>;переносим 11 байтов</td></tr> <tr><td>LEA DX,FCB </td><td>;DS:DX указывают на FCB</td></tr> <tr><td>MOV AH,17H </td><td>;функция изменения имени</td></tr> <tr><td>INT 21H </td><td>;изменяем имя</td></tr> <tr><td>CMP AL,0FFH </td><td>;проверка на ошибку</td></tr> <tr><td>JE RENAME_ERROR </td><td>;уход на обработку ошибки</td></tr> </table> Метод дескриптора файла: <p> Функция 56H прерывания 21H переименовывает и перемещает файлы. DS:DX должны указывать на строку, дающую путь и имя переименуемого файла (до 63-х символов) и завершающуюся символом ASCII 0. ES:DI должны указывать на вторую строку, которая дает новые имя и путь файла. Имена накопителей, если они присутствуют, должны совпадать. Если пути различны, то файл переноносится в другой подкаталог. Чтобы перенести файл без переименования надо во второй строке указать то же самое имя, но другой путь. При возврате, если произошла ошибка, то устанавливается флаг переноса, а AX будет содержать 3 - если один из путей не найден, 5 - при ошибке на диске и 17 - при попытке переноса между разными накопителями. В примере файл ACCOUNTS.DAT переносится из подкаталога GAINS в подкаталог LOSSES. <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>OLDPATH DB 'A:GAINS\ACCOUNTS.DAT',0</td><td></td></tr> <tr><td>NEWPATH DB 'A:LOSSES\ACCOUNTS.DAT',0</td><td></td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---изменение пути файла</td></tr> <tr><td>LEA DX,OLDPATH </td><td>;DS:DX указывают на старый путь</td></tr> <tr><td>MOV AX,SEG NEWPATH </td><td>;ES:DI указывают на новый путь</td></tr> <tr><td>MOV ES,AX </td><td>;</td></tr> <tr><td>MOV DI,OFFSET NEWPATH </td><td>;</td></tr> <tr><td>MOV AH,56H </td><td>;номер функции</td></tr> <tr><td>INT 21H </td><td>;переносим файл</td></tr> <tr><td>JC ERROR_ROUTINE </td><td>;уход на обработку ошибки</td></tr> </table> <hr><p align="center">
<~-<a href="533.htm">5.3.3 Открытие/закрытие файла.</a><br><a href="index.htm#header">Содержание</a><br><a href="535.htm">5.3.5 Подготовка к файловым операциям.</a>-~>
</p></body></html>
