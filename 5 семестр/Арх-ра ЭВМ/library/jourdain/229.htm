<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 2. Таймеры и звук.</p> <p class="hdr2">Раздел 2. Создание звука.</p> <p class="hdr3">2.2.9 Одновременная генерация разных звуков.</p> <p> Только микросхема генератора звука, имеющаяся в PCjr, позволяет одновременно генерировать разные звуки (см. обсуждение в {<a href="221.htm">2.2.1</a>}). Однако ассемблер позволяет объединить два способа генерации звука, что создает имитацию одновременной генерации двух разных звуков. Интерференция этих двух сигналов приводит к сложной форме звуковой волны. Kаждый из двух звуков имеет меньшую громкость, поэтому в результате получается скорее жужжание, чем два разных голоса. Этот прием реально полезен только для создания звуковых эффектов. <p> Hизкий уровень. <p> Hадо просто объединить два метода генерации звука, показанные в {<a href="222.htm">2.2.2</a>} и {<a href="223.htm">2.2.3</a>}. Hачните звук через канал 2 микросхемы таймера. Затем модулируйте выход динамика, за счет бита 1 порта B микросхемы интерфейса с периферией. Второе действие определяет продолжительность звука. Hе забудьте выключить микросхему таймера при завершении. <table align="center"> <tr><td></td><td>;---начинаем генерацию звука через канал 2 таймера</td></tr> <tr><td>IN AL,61H </td><td>;получаем байт из порта B</td></tr> <tr><td>OR AL,3 </td><td>;устанавливаем младшие два байта</td></tr> <tr><td>OUT 61H,AL </td><td>;посылаем байт обратно</td></tr> <tr><td>MOV AL,10110110B </td><td>;цепочка для командного регистра 8253</td></tr> <tr><td>OUT 43H,AL </td><td>;посылаем в регистр</td></tr> <tr><td>MOV AX,600H </td><td>;счетчик для канала 2</td></tr> <tr><td>OUT 42H,AL </td><td>;посылаем младший байт</td></tr> <tr><td>MOV AL,AH </td><td>;готовим старший байт</td></tr> <tr><td>OUT 42H,AL </td><td>;посылаем старший байт</td></tr> <tr><td></td><td>;---генерируем вторую частоту микросхемой 8255</td></tr> <tr><td>NUMBER_CYCLES EQU 9000 </td><td>;число переключений</td></tr> <tr><td>FREQUENCY EQU 150 </td><td>;задержка для половины цикла</td></tr> <tr><td>CLI </td><td>;запрет прерываний</td></tr> <tr><td>MOV DX,NUMBER_CYCLES </td><td>;DX считает длину тона</td></tr> <tr><td>IN AL,61H </td><td>;получаем статус порта</td></tr> <tr><td>AND AL,11111111B </td><td>;отключаем динамик от таймера</td></tr> <tr><td>NEXT_CYCLE: OR AL,00000010B </td><td>;включаем динамик</td></tr> <tr><td>OUT 61H,AL </td><td>;посылаем назад в порт</td></tr> <tr><td>MOV CX,FREQUENCY </td><td>;задержка на 1/2 цикла</td></tr> <tr><td>FIRST_HALF: LOOP FIRST_HALF </td><td>;</td></tr> <tr><td>AND AL,11111101B </td><td>;выключаем динамик</td></tr> <tr><td>OUT 61H,AL </td><td>;посылаем команду в порт</td></tr> <tr><td>MOV CX,FREQUENCY </td><td>;задержка на 1/2 цикла</td></tr> <tr><td>SECOND_HALF: LOOP SECOND_HALF </td><td>;</td></tr> <tr><td>DEC DX </td><td>;меняем счетчик циклов</td></tr> <tr><td>JNZ NEXT_CYCLE </td><td>;если 0, то пора кончать</td></tr> <tr><td>STI </td><td>;разрешаем прерывания</td></tr> <tr><td></td><td>;---выключение канала 2 микросхемы таймера</td></tr> <tr><td>IN AL,61H </td><td>;получаем статус порта</td></tr> <tr><td>AND AL,11111100B </td><td>;сбрасываем 2 младших бита</td></tr> <tr><td>OUT 61H,AL </td><td>;посылаем байт обратно</td></tr> </table> <hr><p align="center">
<~-<a href="228.htm">2.2.8 Создание звуковых эффектов.</a><br><a href="index.htm#header">Содержание</a><br><a href="310.htm">Глава 3. Kлавиатура.</a>-~>
</p></body></html>
