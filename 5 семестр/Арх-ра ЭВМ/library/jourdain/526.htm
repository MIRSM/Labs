<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 5. Дисковые накопители.</p> <p class="hdr2">Раздел 2. Работа с каталогами диска.</p> <p class="hdr3">5.2.6 Спрятанные и защищенные от записи файлы.</p> <p> DOS использует шесть различных атрибутов файлов, которые дают данному файлу определенный статус. Файл может иметь несколько из этих атрибутов одновременно (но не все). Атрибуты устанавливаются 12-м байтом 32-байтного элемента каталога. Младшие шесть битов имеют значение, а остальные должны быть равны нулю. Биты такие: <pre class="asm"> 
   если бит 5 = 1,   то файл был изменен со времени последней 
                     архивации 
            4 = 1,   то файл является подкаталогом 
            3 = 1,   то этот элемент является не файлом, а меткой 
                     тома 
            2 = 1,   то файл является "системным" 
            1 = 1,   то файл спрятан при поиске по каталогу 
            0 = 1,   то файл объявлен только для чтения 
</pre> 
Бит 5 это архивный бит, используемый программами BACKUP и RESTORE DOS. Этот бит сьрасывается в 0 после архивации и устанавливается, когда с файлом снова работали. При следующей архивации неизмененные файлы могут быть обнаружены и проигнорированы. <p> Средний уровень. <p> Функция 43H прерывания 21H может как находить, так и изменять атрибуты файла, но только если файл был открыт с помощью метода дескриптора файлов, а не с помощью метода управляющего блока файла. Hет аналогичной функции для FCB. Байт атрибутов может быть установлен при создании файла {<a href="532.htm">5.3.2</a>}, используя расширенный управляющий блок файла. Hо если Вы последовательно откроете FCB, измените установку атрибутов и затем закроете файл, то у него останутся первоначальные атрибуты. Хотя, конечно, Вы можете изменить атрибуты каким-нибудь обходным путем, но намного проще использовать функцию, использующую метод дескриптора файлов. <p> Чтобы использовать функцию 43H, поместите 1 в AL, чтобы присвоить файлу байт атрибутов, содержащийся в CX (на самом деле в CL, поскольку CH равен 0). Можно наоборот поместить в AL 0, чтобы в CX был возвращен текущий байт атрибутов файла. В обоих случаях DS:DX должны указывать на строку, дающую путь к файлу. Kонец строки отмечается байтом ASCII 0 (который не входит в число 63-х символов). В примере статус "hidden" (спрятанный) присваивается файлу OVERDUE: <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>PATH DB 'A:ACCOUNTS',0</td><td></td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---включаем признак спрятанного файла</td></tr> <tr><td>MOV AH,43H </td><td>;номер функции</td></tr> <tr><td>MOV AL,0 </td><td>;читаем байт атрибутов</td></tr> <tr><td>LEA DX,PATH </td><td>;DS:DX указывают на путь</td></tr> <tr><td>INT 21H </td><td>;байт атрибутов в CX</td></tr> <tr><td>JC ERROR_ROUTINE </td><td>;обработка ошибок</td></tr> <tr><td>OR CL,10B </td><td>;включаем бит 1</td></tr> <tr><td>MOV AH,43H </td><td>;номер функции</td></tr> <tr><td>MOV AL,1 </td><td>;заменяем байт атрибутов</td></tr> <tr><td>INT 21H </td><td>;теперь файл стал спрятанным</td></tr> </table> Флаг переноса устанавливается при возникновении ошибки. В этом случае в AX возвращается 2 - если файл не найден, 3 - если не найден путь и 5 - при других ошибках (нет доступа). <hr><p align="center">
<~-<a href="525.htm">5.2.5 Получение/установка времени и даты последнего доступа к файлу.</a><br><a href="index.htm#header">Содержание</a><br><a href="527.htm">5.2.7 Чтение/изменение метки тома.</a>-~>
</p></body></html>
