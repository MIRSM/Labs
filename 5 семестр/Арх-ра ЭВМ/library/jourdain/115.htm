<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 1. Системные ресурсы.</p> <p class="hdr2">Раздел 1. Ревизия системных ресурсов.</p> <p class="hdr3">1.1.5 Определение числа и типа дисковых накопителей.</p> <p> Hа всех машинах кроме AT (который будет обсуждаться ниже) регистры микросхемы 8255 интерфейса с периферией содержат информацию о том, сколько HГМД имеет машина. В примерах {<a href="111.htm">1.1.1</a>} показано как получить эту информацию. Информация определяющая тип диска содержится в таблице размещения файлов (FAT) диска, которая следит за использованием дискового пространства. Первый байт FAT содержит один из следующих кодов: <pre class="asm"> 
      Kод                    Тип диска 
       FF            двухсторонний, 8 секторов 
       FE            односторонний, 8 секторов 
       FD            двухсторонний, 9 секторов 
       FC            односторонний, 9 секторов 
       F9            двухсторонний, 15 секторов 
       F8            фиксированный диск 
</pre> 
<p> Сама таблица размещение файлов не является файлом. Она может быть считана при помощи функций DOS или BIOS непосредственно читающих определенные сектора диска. В пункте {<a href="511.htm">5.1.1</a>} содержится вся информация необходимая для нахождения и чтения FAT. K счастью, операционная система обеспечивает функцию, которая возвращает идентификационный байт диска. <p> Данные BIOS не показывают число жестких дисков в системе, так как переключатели предназначены только для гибких дисков. Однако Вы можете использовать указанную функцию операционной системы для поиска накопителей. Она возвращает значение 0CDH, вместо одного из упомянутых кодов, когда накопители отсутствуют. Hадо просто проверять все большие и большие номера накопителей, до тех пор пока не будет обнаружено указанное значение. <p> AT уникален в том смысле, что его информация о конфигурации говорит какой тип накопителя используется. Эту информацию можно получить из порта с адресом 71H, предварительно послав номер регистра в порт 70H. Для HГМД номер регистра равен 10H. Информация о первом накопителе содержится в битах 7-4, а о втором - в битах 3-0. В обоих случаях цепочка битов 0000 говорит об отсутствии накопителя, 0001 - о двухстороннем накопителе с плотностью 48 дорожек на дюйм, а 0010 - о накопителе большой емкости (96 дорожек на дюйм). Информация о фиксированном диске содержится в регистре 12H. И снова биты 7-4 и 3-0 соответствуют первому и второму накопителям. 0000 указывает на отсутствие накопителя. Другие 15 возможных значений описывают емкость и конструкцию накопителя. Эти коды сложные; если Вам по какой-то причине потребуется эта информация, обратитесь к техническому руководству по AT. <p> Средний уровень.  <p> Функция 1CH прерывания 21H возвращает информацию об указанном накопителе. Поместите номер накопителя в DL, причем 0 = накопитель по умолчанию, 1 = A, и т.д. При возвращении DX содержит число кластеров в FAT, AL - число секторов в кластере, а CX число байтов в секторе. DS:BX указывает на байт, содержащий код идентификации диска из FAT, согласно приведенной таблице. В следующем примере определяется тип накопителя A: <table align="center"> <tr><td></td><td>;---определение типа диска</td></tr> <tr><td>MOV AH,1CH </td><td>;функция MS DOS</td></tr> <tr><td>MOV DL,1 </td><td>;выбор накопителя A</td></tr> <tr><td>INT 21H </td><td>;получение информации</td></tr> <tr><td>MOV DL,[BX] </td><td>;получение типа накопителя</td></tr> <tr><td>CMP DL,0FDH </td><td>;двухсторонний, 9 секторов?</td></tr> <tr><td>JE DBL_9 </td><td>;и т.д.</td></tr> </table> <p> BIOS AT имеет функцию, сообщающую общие параметры накопителей. Это функция 8 прерывания 13H. Она возвращает число накопителей в DL, максимальное число сторон накопителя в DH, максимальное число секторов в CL и дорожек в CH, а код статуса ошибки накопителя в AH (см. пункт {<a href="548.htm">5.4.8</a>}). <p> Другая функция BIOS AT возвращает тип накопителя. Это функция 15H прерывания 13H, которая требует номера накопителя в DL. В AH возвращается код, причем 0 = нет накопителя, 1 = дискета без обнаружения изменений, 2 = дискета с обнаружением изменений и 3 = фиксированный диск. В случае фиксированного диска в CX:DX возвращается число секторов по 512 байт. <hr><p align="center">
<~-<a href="114.htm">1.1.4 Определение числа и типов адаптеров дисплея.</a><br><a href="index.htm#header">Содержание</a><br><a href="116.htm">1.1.6 Определение числа и типа периферийных устройств.</a>-~>
</p></body></html>
