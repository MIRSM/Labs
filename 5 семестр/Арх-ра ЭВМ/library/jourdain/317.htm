<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 3. Kлавиатура.</p> <p class="hdr2">Раздел 1. Управление клавиатурой.</p> <p class="hdr3">3.1.7 Проверка/установка статуса клавиш-переключателей.</p> <p> Два байта, расположенные в ячейках памяти 0040:0017 и 0040:0018 содержат биты, отражающие статус клавиши сдвига и других клавиш-переключателей следующим образом: <pre class="asm"> 
            Бит    Kлавиша      Значение, когда бит = 1 
0040:0017    7     Insert       режим вставки включен 
             6     CapsLock     режим CapsLock включен 
             5     NumLock      режим NumLock включен 
             4     ScrollLock   режим ScrollLock включен 
             3     Alt          клавиша нажата 
             2     Ctrl         клавиша нажата 
             1     левый Shift  клавиша нажата 
             0     правый Shift клавиша нажата 
0040:0018    7     Insert       клавиша нажата 
             6     CapsLock     клавиша нажата 
             5     NumLock      клавиша нажата 
             4     ScrollLock   клавиша нажата 
             3     Ctrl-NumLock режим Ctrl-NumLock включен 
</pre> 
остальные биты не используются <p> Прерывание клавиатуры немедленно обновляет эти биты статуса, как только будет нажата одна из клавиш-переключателей, даже если не было считано ни одного символа из буфера клавиатуры. Это верно и для клавиши Ins, которая единственная из этих 8 клавиш помещает код в буфер (установка статуса Ins меняется даже если в буфере нет места для символа). Отметим, что бит 3 по адресу 0040:0018 устанавливается в 1, когда действует режим задержки Ctrl-NumLock; поскольку в этом состоянии программа приостановлена, то этот бит несущественен. <p> Прерывание клавиатуры проверяет состояние статусных битов перед тем, как интерпретировать нажатые клавиши, поэтому когда программа меняет один из этих битов, то эффект такой же, как при физическом нажатии соответствующей клавиши. Вы можете захотеть установить состояние клавиш NumLock и CapsLock, чтобы быть уверенным, что ввод будет требуемого вида. Hаоборот, Ваша программа может нуждаться в чтении статуса этих клавиш, например для того, чтобы вывести текущий статус на экран. Отметим, что клавиатура AT правильно устанавливает световые индикаторы состояния клавиш, даже если переключены программно. <p> Средний уровень. <p> Функция 2 прерывания 16H предоставляет доступ к одному - но только одному - из байтов статуса. Это байт по адресу 0040:0017, который содержит больше полезной информации. Байт возвращается в AL. <table align="center"> <tr><td></td><td>;---проверка статуса клавиши вставки</td></tr> <tr><td>MOV AH,2 </td><td>;номер функции</td></tr> <tr><td>INT 16H </td><td>;получаем байт статуса</td></tr> <tr><td>TEST AL,10000000B </td><td>;проверяем бит 7</td></tr> <tr><td>JZ INSERT_OFF </td><td>;если 0, то INSERT выключен</td></tr> </table> <p> Hизкий уровень. <p> В данном примере устанавливается режим вставки, за счет установки бита 7 байта статуса по адресу 0040:0017 (который адресуется как 0000:0417). <table align="center"> <tr><td>SUB AX,AX </td><td>;устанавливаем добавочный сегмент на</td></tr> <tr><td>MOV ES,AX </td><td>;начало памяти</td></tr> <tr><td>MOV AL,10000000B </td><td>;готовим бит 7 к установке</td></tr> <tr><td>OR ES:[417H],AL </td><td>;меняем байт статуса</td></tr> </table> <hr><p align="center">
<~-<a href="316.htm">3.1.6 Получение строки символов.</a><br><a href="index.htm#header">Содержание</a><br><a href="318.htm">3.1.8 Hаписание процедуры ввода с клавиатуры общего назначения.</a>-~>
</p></body></html>
