<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 4. Вывод на терминал.</p> <p class="hdr2">Раздел 5. Сдвиг экрана и страницы.</p> <p class="hdr3">4.5.4 Сдвиг между страницами текста.</p> <p> Поскольку страницы текста прилегают друг к другу в видеобуфере, то небольшой текстовый массив может целиком помещаться в этой памяти. В этом случае текст сдвигаться вверх и вниз по экрану не передвигаясь реально в буфере. Вместо этого экран начинает показывать содержимое буфера, начиная с различных точек и тем самым создавая иллюзию сдвига. Этот метод называется аппаратным сдвигом. <p> Аппаратный сдвиг достигается за счет изменения стартового адреса дисплея, который является числом, указывающим на символ в видеобуфере, который будет выводиться в левом верхнем углу экрана. Добавление 80 к этому числу "сдвигает" весь экран на одну строку вверх, а вычитание 80 - на одну строку вниз. В режиме с 40 символами в строке надо вместо 80 прибавлять или вычитать 40. Hа рис. 4-7 приведена диаграмма аппаратного сдвига. <p> Отметим, что регистр стартового адреса не считает байты атрибутов, поэтому Вы должны вычислять адреса памяти по-другому, чем при прямом отображении в память. Имейте также ввиду, что несмотря на наличие разрывов памяти между границами страниц (96 байтов между 80-символьными страницами и 48 байтов между 40-символьными страницами) микросхема 6845 пропускает эти области и сдвиг непрерывно происходит с одной страницы на следующую. Аппаратный сдвиг происходит настолько быстро, что Вам может оказаться необходимым вставить процедуру задержки, чтобы пользователь имел возможность увидеть насколько сдвинулся экран. <p> BIOS хранит текущее значение регистра стартового адреса в переменной в своей области данных. Эта двухбайтная переменная расположена по адресу 0040:004EH. <p> Hизкий уровень. <p> Стартовый адрес содержится в регистрах 12 (старший байт) и 13 (младший байт) микросхемы 6845. В {<a href="411.htm">4.1.1</a>} объясняется работа этой микросхемы. Прежде чем адресуемый байт направляется в порт с адресом 3D5H, необходимо послать номер адресуемого регистра в порт 3D4H. В данном примере экран сдвигается вверх на одну строку. Переменная START_ADDRESS содержит адрес первого символа текущей верхней строки экрана. <table align="center"> <tr><td>MOV BX,START_ADDRESS </td><td>;начинаем с начала буфера</td></tr> <tr><td>ADD BX,80 </td><td>;сдвигаем на 1 строку (80 символов)</td></tr> <tr><td>MOV DX,3D4H </td><td>;вывод в адресный регистр</td></tr> <tr><td>MOV AL,12 </td><td>;адресуем регистр 12</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем запрос</td></tr> <tr><td>INC DX </td><td>;теперь выводим в командный регистр</td></tr> <tr><td>MOV AL,BH </td><td>;старшее слово в AL</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем его в регистр 12</td></tr> <tr><td>DEC DX </td><td>;обратно к адресному регистру</td></tr> <tr><td>MOV AL,13 </td><td>;адресуем регистр 13</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем запрос</td></tr> <tr><td>INC DX </td><td>;снова командный регистр</td></tr> <tr><td>MOV AL,BL </td><td>;младшее слово в AL</td></tr> <tr><td>OUT DX,AL </td><td>;посылаем в регистр 13</td></tr> </table> <hr><p align="center">
<~-<a href="453.htm">4.5.3 Переключение между текстовыми страницами.</a><br><a href="index.htm#header">Содержание</a><br><a href="510.htm">Глава 5. Дисковые накопители.</a>-~>
</p></body></html>
