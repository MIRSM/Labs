<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 2. Таймеры и звук.</p> <p class="hdr2">Раздел 2. Создание звука.</p> <p class="hdr3">2.2.7 Создание плавного перехода тонов.</p> <p> Плавные переходы тонов производятся за счет непрерывного изменения частоты. Этого можно достигнуть как в Бейсике, так и программируя на низком уровне. Этот звуковой эффект можно сделать более выразительным, если немного уменьшать длительность каждого сегмента тона при повышении звука или слегка увеличивать длительность при понижении. <p> Hизкий уровень. <p> Проще всего использовать метод генерации звука, управляемый микросхемой интерфейса с периферией 8255. Просто меняйте значение бита 1 порта B между 0 и 1, используя для отсчета времени пустой цикл, как показано в {<a href="222.htm">2.2.2</a>}. При начале каждого нового пустого цикла, засчет засылки значения в CX, слегка изменяйте это значение. Здесь тон повышается: <table align="center"> <tr><td></td><td>;---запрет микросхемы таймера</td></tr> <tr><td>PB EQU 61H </td><td>;адрес порта B микросхемы 8255</td></tr> <tr><td>IN AL,PB </td><td>;получаем из него байт</td></tr> <tr><td>OR AL,1 </td><td>;сбрасываем бит 0</td></tr> <tr><td>OUT PB,AL </td><td>;возвращаем байт в порт</td></tr> <tr><td></td><td>;---установка частоты и длительности звука</td></tr> <tr><td>MOV BX,9000 </td><td>;начальное значение счетчика</td></tr> <tr><td>MOV DX,3000 </td><td>;длительность звука 3000 циклов</td></tr> <tr><td>REPEAT: </td><td>;сюда возвращаемся после цикла</td></tr> <tr><td></td><td>;---установка бита динамика</td></tr> <tr><td>OR AL,00000010B </td><td>;устанавливаем бит 1</td></tr> <tr><td>OUT PB,AL </td><td>;посылаем байт в порт B</td></tr> <tr><td>MOV CX,BX </td><td>;установка счетчика для 1/2 цикла</td></tr> <tr><td>CYCLE1: LOOP CYCLE1 </td><td>;пустой цикл на 1000 повторов</td></tr> <tr><td></td><td>;---сброс бита динамика</td></tr> <tr><td>AND AL,11111101B </td><td>;сбрасываем бит 1</td></tr> <tr><td>OUT PB,AL </td><td>;посылаем байт в порт</td></tr> <tr><td>MOV CX,BX </td><td>;установка счетчика</td></tr> <tr><td>CYCLE2: LOOP CYCLE2 </td><td>;пустой цикл</td></tr> <tr><td></td><td>;---переход к следующему циклу</td></tr> <tr><td>DEC BX </td><td>;увеличиваем частоту, уменьшая</td></tr> <tr><td>DEC BX </td><td>;счетчик</td></tr> <tr><td>DEC DX </td><td>;уменьшаем оставшуюся длительность</td></tr> <tr><td>JNZ REPEAT </td><td>;если DX не 0, то новый цикл</td></tr> </table> Этот простой метод приводит к тому, что высокие тона проходят значительно быстрее, чем низкие. Для коротких интервалов такой эффект может быть желательным, а когда он не нужен, надо добавить код, который при повышении тона пересылает в DX большие значения на следующем цикле. <hr><p align="center">
<~-<a href="226.htm">2.2.6 Генерация строки тонов, одновременно с другими операциями.</a><br><a href="index.htm#header">Содержание</a><br><a href="228.htm">2.2.8 Создание звуковых эффектов.</a>-~>
</p></body></html>
