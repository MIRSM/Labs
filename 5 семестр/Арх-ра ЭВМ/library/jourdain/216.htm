<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 2. Таймеры и звук.</p> <p class="hdr2">Раздел 1. Установка и чтение таймера.</p> <p class="hdr3">2.1.6 Операции запрограммированные во времени.</p> <p> Программа определяет время для выполнения определенной операции в точности так же, как и человек: берется начальное показание счетчика времени суток и затем сравнивается с последующими пока-  заниями. Можно получать значения в формате часы-минуты-секунды, но слишком хлопотно вычислять разницу между такими показаниями, поскольку система счета не десятичная. Лучше прямо читать счетчик времени суток BIOS, измерять продолжительность в 1/18 секунды, а затем уже переводить ее в обычный формат чч:мм:сс. <p> Средний уровень. <p> Прерывание 1AH имеет две функции для установки (AH = 1) и получения (AH = 0) счетчика времени суток. Для чтения счетчика надо просто выполнить прерывание с AH = 0. При возврате значение счетчика содержится в CX:DX, причем младшее слово в CX. AL содержит 0, если счетчик не переходил через границу 24 часов с момента последней установки. Для установки счетчика поместите два слова в те же регистры, а в AH - 1. В приведенном примере измеряются промежутки времени в пределах часа. При этом нужны только два младших байта счетчика. Hо в этом случае необходимо проверять, что не было перехода через границу, когда начальное значение было больше, чем следующее. <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>OLDCOUNT DW 0 </td><td>;храним начальное значение счетчика</td></tr> <tr><td></td><td>;---получаем начальное значение счетчика</td></tr> <tr><td>MOV AH,0 </td><td>;номер функции</td></tr> <tr><td>INT 1AH </td><td>;получаем значение счетчика</td></tr> <tr><td>MOV OLDCOUNT,DX </td><td>;сохраняем начальное значение</td></tr> <tr><td>.</td><td></td></tr> <tr><td>(здесь идет процесс, длительность которого измеряется)</td><td></td></tr> <tr><td>.</td><td></td></tr> <tr><td></td><td>;---позднее вычисляем длительность процесса</td></tr> <tr><td>MOV AH,0 </td><td>;номер функции</td></tr> <tr><td>INT 1AH </td><td>;получаем значение счетчика</td></tr> <tr><td>MOV BX,OLDCOUNT </td><td>;считываем старое значение</td></tr> <tr><td>CMP BX,DX </td><td>;проверяем на переполнение</td></tr> <tr><td>JG ADJUST </td><td>;обработка переполнения</td></tr> <tr><td>SUB DX,BX </td><td>;иначе берем разность</td></tr> <tr><td>JMP SHORT FIGURE_TIME </td><td>;и переводим ее в обычный вид</td></tr> <tr><td></td><td>;---обработка переполнения</td></tr> <tr><td>ADJUST: MOV CX,0FFFFH </td><td>;помещаем в CX максимальное число</td></tr> <tr><td>SUB CX,BX </td><td>;вычитаем первое значение</td></tr> <tr><td>ADD CX,DX </td><td>;добавляем второе значение</td></tr> <tr><td>MOV DX,CX </td><td>;результат храним в DX</td></tr> <tr><td></td><td>;---процедура перевода времени в обычный формат</td></tr> <tr><td>FIGURE_TIME: </td><td>;делим на 18.2 секунды и т.д.</td></tr> </table> <hr><p align="center">
<~-<a href="215.htm">2.1.5 Задержка программных операций.</a><br><a href="index.htm#header">Содержание</a><br><a href="217.htm">2.1.7 Управление работой в реальном времени.</a>-~>
</p></body></html>
