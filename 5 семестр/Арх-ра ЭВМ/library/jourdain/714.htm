<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 7. Ввод/вывод.</p> <p class="hdr2">Раздел 1. Доступ к последовательному порту.</p> <p class="hdr3">7.1.4 Определение статуса коммуникационного порта.</p> <p> Регистр статуса линии микросхемы UART 8250 определяет протокол связи. Этот регистр имеет адрес порта на 5 больше, чем базовый адрес данного канала. Обычно он постоянно просматривается в процессе коммуникационного обмена. При передаче данных регистр сообщает, что предыдущий символ уже послан, позволяя программе записать новый символ поверх его. При приеме данных регистр информирует программу о поступлении следующего символа, с тем чтобы программа могла прочитать его прежде чем он будет уничтожен следующим прибывшим. Значение битов этого регистра следующее: <pre class="asm"> 
   бит 0   1 = байт данных получен 
       1   1 = полученные данные были перезаписаны (предыдущий 
               символ не был вовремя считан) 
       2   1 = ошибка четности (вероятно, из-за шума в линии) 
       3   1 = ошибка окружения (передача не синхронизована) 
       4   1 = обнаружен перерыв (получена длинная строка единиц, 
               индицирующая, что другая станция запрашивает 
               конец передачи) 
       5   1 = регистр хранения передатчика пуст (в этот регистр 
               должны помещаться передаваемые данные) 
       6   1 = регистр сдвига передатчика пуст (этот регистр по
               лучает данные из регистра хранения и преобразует 
               их в последовательный вид) 
       7   1 = таймаут (устройство не связано с машиной) 
</pre> 
<p> Hизкий уровень. <p> Этот пример совершенно аналогичен приведенному на Бейсике. Из области данных BIOS считывается базовый адрес коммуникационного канала, к нему добавляется 5, а затем из полученного адреса порта считывается байт статуса. <table align="center"> <tr><td>MOV AX,40H </td><td>;ES указывает на область данных BIOS</td></tr> <tr><td>MOV ES,AX </td><td>;</td></tr> <tr><td>MOV DX,ES:[2] </td><td>;получаем базовый адрес COM2</td></tr> <tr><td>ADD DX,5 </td><td>;добавляем 5 для регистра статуса</td></tr> <tr><td>IN AL,DX </td><td>;получаем байт статуса</td></tr> <tr><td>TEST AL,10000B </td><td>;бит 5 установлен?</td></tr> <tr><td>JNZ BREAK_DETECT </td><td>;если да, то на обработку перерыва</td></tr> </table> <hr><p align="center">
<~-<a href="713.htm">7.1.3 Установка текущего коммуникационного порта.</a><br><a href="index.htm#header">Содержание</a><br><a href="715.htm">7.1.5 Инициализация и управление модемом.</a>-~>
</p></body></html>
