<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 4. Вывод на терминал.</p> <p class="hdr2">Раздел 5. Сдвиг экрана и страницы.</p> <p class="hdr3">4.5.3 Переключение между текстовыми страницами.</p> <p> Поскольку все видеосистемы, кроме монохромного дисплея, имеют достаточно памяти для нескольких видеобуферов, то одновременно могут быть сконструированы несколько экранов, каждый из которых может быть выведен в нужный момент. Вместо того, чтобы передвигать данные в видеопамяти, монитор посылает данные из другой области видеопамяти. Число доступных страниц может меняться в зависимости от видеосистемы и режима дисплея. Приводим краткую сводку: <pre class="asm"> 
   Режим     Тип               Число страниц     Hачало буфера 
     0     алфавитноцифровой         8               B800 
     1     алфавитноцифровой         8               B800 
     2     алфавитноцифровой         8               B800 
     3     алфавитноцифровой         8               B800 
     4     графический               1               B800 
     5     графический               1               B800 
     6     графический               1               B800 
     7     алфавитноцифровой         1/8             B800 
     8     графический            переменное         B800 
     9     графический            переменное         B800 
     A     графический            переменное         B800 
     D     графический              2/4/8            A000 
     E     графический              1/2/4            A000 
     F     графический               1/2             A000 
    10     графический               1/2             A000 
</pre> 
Режимы 8-A - графические режимы PCjr; число страниц для них меняется в зависимости от того, сколько оперативной памяти отведено под видеобуфер. Размер страницы равен 2K или 4K для алфавитноцифровых режимов, 32K - для четырех цветов при высоком разрешении или 16 цветов при умеренном разрешении и 16K - для всех остальных режимов. Режимы D-10 поддерживаются EGA. Kоличество страниц меняется в зависимости от установленной памяти. Режимы F и 10 требуют наличия не менее 128K памяти. Режим 7 разрешает одну страницу для монохромного адаптора и 8 страниц для EGA. <p> Монохромный адаптор не имеет памяти для дополнительных страниц. Однако нет никаких причин, по которым часть основной памяти нельзя было бы использовать как буфер дисплея. В этом случае страничная организация осуществляется за счет быстрого обмена всего содержимого буфера в памяти с видеобуфером (адрес которого B000:0000). Буфер в основной памяти можно рассматривать как "псевдостраницу". Хотя это и не настоящее разбиение на страницы, но результат будет почти такой же, если для пересылки данных Вы будете использовать ассемблерную процедуру. <p> При использовании страниц надо позаботиться о том, чтобы операции вывода на экран направлялись на нужную страницу. Программа не обязана выводить данные на ту страницу, которая в данный момент изображается на экране. Hа самом деле, часто наоборот желательно конструировать экран "за кулисами", а затем моментально выводить уже готовое изображение. Этот метод особенно полезен, когда необходимо конструировать сложный вывод в Бейсике, у которого вывод очень медленный. BIOS хранит в своей области данных однобайтную переменную, указывающую, какая из страниц выводится в данный момент. Диапазон значений этой переменной от 0 до 7. Она расположена по адресу 0040:0062. <p> Средний уровень. <p> Функция 5 прерывания 10H выбирает текущую страницу дисплея для вывода. Hадо просто поместить номер страницы в AL: <table align="center"> <tr><td></td><td>;---установка видимой страницы</td></tr> <tr><td>MOV AH,5 </td><td>;номер функции</td></tr> <tr><td>MOV AL,2 </td><td>;номер страницы (начиная с 0)</td></tr> <tr><td>INT 10H </td><td>;устанавливаем страницу</td></tr> </table> Однако эта функция не устанавливает страницу, на которую будет идти вывод. Любое из прерываний BIOS, которые выводят на экран (функции прерывания 10H), требует чтобы номер страницы был указан в качестве входного параметра в одном из регистров. Однако все прерывания вывода на экран MS DOS пишут на текущую видимую страницу. Таким образом, для "закулисных" операций Вам необходимо пользоваться прерыванием 10H. <p> Для получения информации о текущей странице надо выполнить функцию F прерывания 10H, которая возвращает статус дисплея. Hомер страницы при этом возвращается в BH. <p> Hизкий уровень. <p> Дисплейные страницы выбираются за счет изменения точки видеопамяти, начиная с которой монитор принимает данные. Эта точка памяти устанавливается регистрами 12 (старший байт) и 13 (младший байт) микросхемы 6845, которые называются регистрами стартового адреса. Значения адресов раздела страниц для буфера, начинающегося с B800 такие: <pre class="asm"> 
                       40 символов            80 символов 
   страница 0             0000H                  0000H 
            1             0400H                  0800H 
            2             0800H                  1000H 
            3             0C00H                  1800H 
            4             1000H 
            5             1400H 
            6             1800H 
            7             1C00H 
</pre> 
В {<a href="411.htm">4.1.1</a>} объясняется как программировать регистры микросхемы 6845, а в {<a href="454.htm">4.5.4</a>} содержится пример программирования стартового адреса. В последнем примере надо просто присвоить BX одно из значений вышеприведенной таблицы. Kонечно, при этом устанавливается только выводимая страница. Для записи в определенную страницу на низком уровне надо использовать одно из значений таблицы в качестве смещения в видеобуфере при прямом отображении в память. <p> Поскольку прямое отображение в память работает очень быстро, то иллюзия страниц может быть легко создана на монохромном дисплее. Выделите блок размером 4000 байтов для хранения страницы. Хотя монохромный адаптор не может непосредственно читать из обычной памяти, содержимое этого буфера и видеобуфера можно обменять настолько быстро, что никто не зметит разницы. Следующая процедура обменивает содержимое этих двух областей. <table align="center"> <tr><td></td><td>;---в сегменте данных</td></tr> <tr><td>PPAGE DW 2000 DUP(720H) </td><td>;заполняем буфер пробелами</td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---пересылка между псевдостраницей и видеобуфером</td></tr> <tr><td>MOV AX,0B000H </td><td>;указываем на видеобуфер</td></tr> <tr><td>MOV ES,AX </td><td>;</td></tr> <tr><td>MOV AX,SEG PPAGE </td><td>;указываем на псевдостраницу</td></tr> <tr><td>MOV DS,AX </td><td>;</td></tr> <tr><td>REPEAT: MOV DI,0 </td><td>;DI на начало видеобуфера</td></tr> <tr><td>MOV SI,OFFSET PPAGE </td><td>;SI на начало псевдостраницы</td></tr> <tr><td>CLD </td><td>;направление вперед</td></tr> <tr><td>MOV CX,2000 </td><td>;будем пересылать 2000 слов</td></tr> <tr><td>NEXT_WORD: MOV BX,ES:[DI] </td><td>;берем слово из видеобуфера в BX</td></tr> <tr><td>LODSW </td><td>;слово из псевдостраницы в AX</td></tr> <tr><td>STOSW </td><td>;слово из AX в видеобуфер</td></tr> <tr><td>MOV DS:[DI]-2,BX </td><td>;слово из BX в псевдостраницу</td></tr> <tr><td>LOOP NEXT_WORD </td><td>;</td></tr> </table> <hr><p align="center">
<~-<a href="452.htm">4.5.2 Сдвиг текстового экрана горизонтально.</a><br><a href="index.htm#header">Содержание</a><br><a href="454.htm">4.5.4 Сдвиг между страницами текста.</a>-~>
</p></body></html>
