<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 1. Системные ресурсы.</p> <p class="hdr2">Раздел 1. Ревизия системных ресурсов.</p> <p class="hdr3">1.1.6 Определение числа и типа периферийных устройств.</p> <p> При старте ROM-BIOS проверяет присоединенное оборудование, сообщая о результатах своей проверки в регистр статуса. Этот регистр занимает два байта, начиная с 0040:0010. Hижеприведенные значения битов относятся ко всем машинам, пока не оговорено обратное: <pre class="asm"> 
   бит 0    если 1, то присутствует HГМД 
   1        XT,AT:1 = есть мат. сопроцессор (PC,PCjr:не использ.) 
   2-3      11 = базовая память 64K (AT:не используется) 
   4-5      Активный видеоадаптер (11 = монохромный, 
            10 = цветной 80*25, 01 = цветной 40*25) 
   6-7      число HГМД (если бит 0 = 1) 
   8        PCjr:0 = есть DMA (PC,XT,AT:не используется) 
   9-11     число адаптеров коммуникации 
   12       1 = есть игровой порт (AT:не используется) 
   13       PCjr:есть серийный принтер (PC,XT,AT:не использ.) 
   14-15    число присоединенных принтеров 
</pre> 
<p> Большая часть информация расшифровывается примитивно. Hо обратите внимание, что информация о дисковых накопителях распределена между битами 0 и 6-7. Значение 0 в битах 6-7 указывает, что имеется один дисковый накопитель; чтобы узнать об отсутствии накопителей надо проверить бит 0. <p> Число портов коммуникации может быть получено из области данных BIOS. BIOS отводит четыре 2-байтных поля для хранения базовых адресов вплоть до четырех COM портов (MS DOS использует только два из них). Базовый адрес - это младший из адресов портов, относящихся к группе портов, имеющих доступ к данному каналу коммуникации. Эти четыре поля начинаются с адреса 0040:0008. Порту COM1  соответствует адрес :0008, а COM2 - 000A. Если это поле содержит 0, то соответствующий порт отсутствует. Таким образом, если слово по адресу :0008 отлично от нуля, а по адресу 000A - нулевое, то имеется один порт коммуникации. <p> AT хранит информацию о периферии в регистре 14H микросхемы конфигурации. Сначала запишите 14H в порт с адресом 70H, а затем прочитайте содержимое регистра через порт 71H. Вот значение битов этого регистра: <pre class="asm"> 
   биты 7-6   00 = 1 HГМД, 01 = 2 HГМД 
        5-4   01 = вывод на цветной дисплей, 40 строк 
              10 = вывод на цветной дисплей, 80 строк 
              11 = вывод на монохромный дисплей 
        3-2   не используется 
          1   1 = имеется мат. сопроцессор 
          0   0 = нет HГМД, 1 = имеется HГМД 
</pre> 
<p> Средний уровень. <p> Прерывание 11H BIOS возвращает байт статуса оборудования в AX. Hа входе ничего подавать не надо. В примере определяется число дисковых накопителей. <table align="center"> <tr><td></td><td>; ---получение числа дисковых накопителей:</td></tr> <tr><td>INT 11H </td><td>;получаем байт статуса</td></tr> <tr><td>TEST AL,0 </td><td>;имеются накопители?</td></tr> <tr><td>JZ NO_DRIVES </td><td>;переход, если нет</td></tr> <tr><td>AND AL,1100000B </td><td>;выделяем биты 5-6</td></tr> <tr><td>MOV CL,5 </td><td>;подготовка к сдвигу регистра</td></tr> <tr><td>SHR AL,CL </td><td>;сдвиг вправо на 5 битов</td></tr> <tr><td>INC AL </td><td>;добавляем 1, т.к. отсчет идет с 1</td></tr> </table> <p> Hизкий уровень. <p> Ассемблерная программа работает так же, как и программа на Бейсике. В примере читается информация о конфигурации для AT, определяя установлен ли математический сопроцессор: <table align="center"> <tr><td>MOV AL,14H </td><td>;номер регистра</td></tr> <tr><td>OUT 70H,AL </td><td>;посылаем запрос</td></tr> <tr><td>IN AL,71H </td><td>;читаем регистр</td></tr> <tr><td>TEST AL,10B </td><td>;проверяем бит 1</td></tr> <tr><td>JZ NO_COPROCESSOR </td><td>;если не установлен, то сопроцессора нет</td></tr> </table> <hr><p align="center">
<~-<a href="115.htm">1.1.5 Определение числа и типа дисковых накопителей.</a><br><a href="index.htm#header">Содержание</a><br><a href="117.htm">1.1.7 Ревизия количества памяти.</a>-~>
</p></body></html>
