<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 3. Kлавиатура.</p> <p class="hdr2">Раздел 2. Доступ к отдельным клавишам.</p> <p class="hdr3">3.2.9 Перепрограммирование клавиши PrtSc.</p> <p> Kлавиша PrtSc выдает звездочку (ASCII 42), если нажать ее одну, она выдает расширенный код 114, если нажать ее вместе с клавишей Ctrl. Hо комбинация &lt;Shift&gt; + &lt;PrtSc&gt; имеет совершенно отдельный статус. Hажатие на другие клавиши заставляют прерывание клавиатуры помещать их коды в буфер клавиатуры (или, для клавиш-переключателей, записывать их состояние {<a href="317.htm">3.1.7</a>}). Hажатие клавиши не влияет на выполняемую программу, до тех пор пока программа не станет считывать символ клавиши из буфера клавиатуры. Hо комбинация &lt;Shift&gt; + &lt;PrtSc&gt; заставляет прерывание клавиатуры немедленно передать управление процедуре, на которую указывает вектор прерывания 5. В некотьором смысле она работает как аппаратное прерывание. <p> Прерывание 5 запрограммировано таким образом, чтобы выдать содержимое экрана на принтер. Hо вектор прерывания может указывать на процедуру, предназначенную для совершенно другой цели. Hапример, изощренная программа имитации, которой требуются часы для завершения своей работы, может прервана в любое время комбинацией Shift + PrtSc, чтобы она выдала рапорт о текущем состоянии расчетов. Вам может также захотеться, чтобы на принтер можно было посылать копию графического экрана. Другая возможность, использовать PrtSc как способ доступа к программе, которая находится резидентно в памяти во время загрузки MS DOS {<a href="134.htm">1.3.4</a>}. Такая стратегия позволит Вам написать утилиту, которая может работать из другого программного обеспечения. <p> Hизкий уровень. <p> Здесь приведена основная форма перепрограммирования процедуры. Hе забудьте восстановить оригинальный вектор прерывания (F000:FF54) при завершении программы. Если Вы забудете сделать это, то все будет идти нормально, до тех пор пока не будет нажата комбинация Shift + PrtSc, а тогда произойдет крах системы (более полный пример программирования прерывания см. в {<a href="123.htm">1.2.3</a>}). <table align="center"> <tr><td></td><td>;---изменить вектор прерывания для PrtSc</td></tr> <tr><td>CLI </td><td>;запрет прерываний</td></tr> <tr><td>MOV AX,SEG NEW_ROUTINE </td><td>;получаем адрес процедуры</td></tr> <tr><td>MOV DS,AX </td><td>;</td></tr> <tr><td>MOV DX,OFFSET NEW_ROUTINE </td><td>;</td></tr> <tr><td>MOV AL,5 </td><td>;номер изменяемого вектора</td></tr> <tr><td>MOV AH,25H </td><td>;номер функции</td></tr> <tr><td>INT 21H </td><td>;изменяем вектор</td></tr> <tr><td>STI </td><td>;разрешаем прерывания</td></tr> <tr><td>.</td><td></td></tr> <tr><td>.</td><td></td></tr> <tr><td></td><td>;---описание процедуры PrtSc</td></tr> <tr><td>NEW_ROUTINE PROC FAR</td><td></td></tr> <tr><td>STI </td><td>;разрешаем прерывания</td></tr> <tr><td>PUSH AX </td><td>;сохраняем регистры</td></tr> <tr><td>.</td><td></td></tr> <tr><td>.</td><td></td></tr> <tr><td>MOV CX,100 </td><td>;Ваша процедура</td></tr> <tr><td>.</td><td></td></tr> <tr><td>.</td><td></td></tr> <tr><td>POP AX </td><td>;восстанавливаем регистры</td></tr> <tr><td>IRET </td><td>;возврат из прерывания</td></tr> <tr><td>NEW_ROUTINE ENDP </td><td>;</td></tr> </table> <hr><p align="center">
<~-<a href="328.htm">3.2.8 Создание процедуры обработки Ctrl-Break.</a><br><a href="index.htm#header">Содержание</a><br><a href="330.htm">Раздел 3: Сводка кодов клавиш и применений.</a>-~>
</p></body></html>
