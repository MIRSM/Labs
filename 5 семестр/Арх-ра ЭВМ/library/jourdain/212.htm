<html><head><title>Справочник программиста на персональном компьютере фирмы IBM.Роберт Журден</title> <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> <link rel=stylesheet type=text/css href=style.css> </head><body> <p class="hdr1">Глава 2. Таймеры и звук.</p> <p class="hdr2">Раздел 1. Установка и чтение таймера.</p> <p class="hdr3">2.1.2 Установка/чтение времени.</p> <p> При старте MS DOS запрашивает у пользователя текущее время. Введенное значение помещается в 4 байта, хранящие счетчик времени суток (начиная с 0040:006C, младший байт хранится первым). Hо сначала оно преобразуется в форму, в которой подсчитывается время суток, т.е. время преобразуется в число восемнадцатых долей секунды, прошедших с полночи. Это число постоянно обновляется 18.2 раз в секунду прерыванием таймера. Kогда появляется очередной запрос на время, то текущее значение счетчика времени суток преобразуется обратно в привычный формат часы-минуты-секунды. Если при старте не было введено значения, то счетчик устанавливается в ноль, как будто сейчас полночь. Kомпьютеры снабженные микросхемой календаря-часов могут автоматически устанавливать счетчик времени суток. <p> Средний уровень. <p> MS DOS предоставляет прерывания для чтения и установки времени, производя необходимые преобразования между значением счетчика времени суток и часами-минутами-секундами. Время выдается с точностью до 1/100 секунды, но поскольку счетчик времени суток обновляется с частотой в пять раз меньшей, то показания сотых секунд очень приближенные. Функция 2CH прерывания 21H выдает время, а функция 2DH - устанавливает его. В обоих случаях CH содержит часы (от 0 до 23, где 0 соответствует полночи), CL - минуты (от 0 до 59), DH - секунды (от 0 до 59) и DL - сотые доли секунд (от 0 до 99). <p> Kроме того при получении времени функцией 2CH, AL содержит номер дня недели (0 = воскресенье). Значение дня будет верным только если была установлена дата. DOS вычисляет номер дня недели по дате. Отметим также, что при установке времени функцией 2DH, AL отмечает правильность введенного значения времени (0 = правильно, FF = неправильно). <table align="center"> <tr><td></td><td>;---установка времени</td></tr> <tr><td>MOV CH,HOURS </td><td>;вводим значения времени</td></tr> <tr><td>MOV CL,MINUTES </td><td>;</td></tr> <tr><td>MOV DH,SECONDS </td><td>;</td></tr> <tr><td>MOV DL,HUNDREDTHS </td><td>;</td></tr> <tr><td>MOV AH,2DH </td><td>;номер функции установки времени</td></tr> <tr><td>INT 21H </td><td>;устанавливаем время</td></tr> <tr><td>CMP AH,0FFH </td><td>;проверяем правильность значения</td></tr> <tr><td>JE ERROR </td><td>;переход на обработку ошибки</td></tr> <tr><td></td><td></td></tr> <tr><td></td><td>;---получение времени</td></tr> <tr><td>MOV AH,2CH </td><td>;номер функции получения времени</td></tr> <tr><td>INT 21H </td><td>;получаем время</td></tr> <tr><td>MOV DAY_OF_WEEK,AH </td><td>;получаем день недели из AH</td></tr> </table> <p> Hизкий уровень. <p> Если Вы изменили скорость импульсов канала 1 микросхемы 8253 для специальных приложений, то Вам необходимо написать свою процедуру декодирования показаний счетчика времени суток. BIOS позволяет диапазон значений счетчика от 0 до 1.573 миллиона и это может быть изменено только путем изменения прерывания таймера. Поэтому часы, реально показывающие сотые доли секунды, не могут работать 24 часа без специально написанной программы. Отметим также, что байт 0040:0070 устанавливается в ноль при старте, а затем увеличивается на 1 (не больше) по ходу часов. <hr><p align="center">
<~-<a href="211.htm">2.1.1 Программирование микросхемы таймера 8253/8254.</a><br><a href="index.htm#header">Содержание</a><br><a href="213.htm">2.1.3 Установка/чтение даты.</a>-~>
</p></body></html>
